ТекстЗапроса = "ВЫБРАТЬ
               |	DR_НастройкиДополнительныеРеквизиты.Реквизит КАК Имя,
               |	DR_НастройкиДополнительныеРеквизиты.Значение КАК Синоним
               |ПОМЕСТИТЬ ВТ_ВидыДокументов
               |ИЗ
               |	Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_НастройкиДополнительныеРеквизиты
               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки КАК DR_Настройки
               |		ПО DR_НастройкиДополнительныеРеквизиты.Ссылка = DR_Настройки.Ссылка
               |ГДЕ
               |	DR_Настройки.ВидНастройки = ""Перечисления""
               |	И DR_Настройки.Наименование = ""ВидыДокументов""
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВЫБОР
               |		КОГДА ТИПЗНАЧЕНИЯ(DR_События_ПервыйУровень.Документ) = ТИП(Документ.СчетФактураВыданный)
               |			ТОГДА DR_События_ПервыйУровень.Идентификатор
               |		ИНАЧЕ DR_События_ПервыйУровень.ИдентификаторОснования
               |	КОНЕЦ КАК КлючСвязиКвитанции,
               |	DR_События_ПервыйУровень.ВидДокумента КАК ВидДокумента,
               |	DR_События_ПервыйУровень.Документ КАК Документ,
               |	DR_События_ВторойУровень.Идентификатор КАК Идентификатор,
               |	DR_События_ПервыйУровень.ИдентификаторОснования КАК ИдентификаторОснования,
               |	DR_События_ПервыйУровень.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_События_ВторойУровень.ВидДокумента КАК ВидДокумента_Первичный,
               |	DR_События_ВторойУровень.Документ КАК Документ_Первичный
               |ПОМЕСТИТЬ ВТ_Квитанции_Первичный
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События_ВторойУровень
               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_События_ПервыйУровень
               |		ПО DR_События_ВторойУровень.ИдентификаторОснования = DR_События_ПервыйУровень.Идентификатор
               |ГДЕ
               |	DR_События_ВторойУровень.ИдентификаторЦепочки = &ИдентификаторЦепочки
               |	И DR_События_ВторойУровень.ВидДокумента В(&ВидыДокументовКвитанций)
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВТ_ПослеПервойИтерации.ВидДокумента_Первичный КАК ВидДокумента,
               |	ВЫБОР
               |		КОГДА ВТ_ПослеПервойИтерации.ВидДокумента В (&ВидыДокументовКвитанций)
               |			ТОГДА DR_События.Документ
               |		ИНАЧЕ ВТ_ПослеПервойИтерации.Документ
               |	КОНЕЦ КАК Документ,
               |	ВТ_ПослеПервойИтерации.Идентификатор КАК Идентификатор,
               |	ВЫБОР
               |		КОГДА ВТ_ПослеПервойИтерации.ВидДокумента В (&ВидыДокументовКвитанций)
               |			ТОГДА DR_События.ИдентификаторОснования
               |		ИНАЧЕ ВТ_ПослеПервойИтерации.ИдентификаторОснования
               |	КОНЕЦ КАК ИдентификаторОснования,
               |	ВТ_ПослеПервойИтерации.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	ВТ_ПослеПервойИтерации.Документ_Первичный КАК ПервичноеПредставление,
               |	ВТ_ПослеПервойИтерации.КлючСвязиКвитанции КАК ИдентификаторДляКвитанций
               |ПОМЕСТИТЬ ВТ_Квитанции_ЮЗД
               |ИЗ
               |	ВТ_Квитанции_Первичный КАК ВТ_ПослеПервойИтерации
               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_События
               |		ПО ВТ_ПослеПервойИтерации.ИдентификаторЦепочки = DR_События.ИдентификаторЦепочки
               |			И ВТ_ПослеПервойИтерации.ИдентификаторОснования = DR_События.Идентификатор
               |
               |ОБЪЕДИНИТЬ ВСЕ
               |
               |ВЫБРАТЬ
               |	DR_События_Первичный.ВидДокумента,
               |	DR_События_Основание.Документ,
               |	DR_События_Первичный.Идентификатор,
               |	DR_События_Первичный.ИдентификаторОснования,
               |	DR_События_Первичный.ИдентификаторЦепочки,
               |	DR_События_Первичный.Документ,
               |	DR_События_Первичный.Идентификатор
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События_Первичный
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_События_Основание
               |		ПО DR_События_Первичный.ИдентификаторОснования = DR_События_Основание.Идентификатор
               |ГДЕ
               |	DR_События_Первичный.ИдентификаторЦепочки = &ИдентификаторЦепочки
               |	И DR_События_Первичный.ВидДокумента В(&ВидыДокументовЮЗД)
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	ВЫБОР
               |		КОГДА НЕ ВТ_ВидыДокументов.Имя ЕСТЬ NULL
               |			ТОГДА ВТ_ВидыДокументов.Синоним
               |		ИНАЧЕ DR_События.ВидДокумента
               |	КОНЕЦ КАК ВидДокументаСиноним,
               |	ВЫБОР
               |		КОГДА DR_События.ВидДокумента = ""СчетФактура_Исходящий""
               |			ТОГДА DR_События.ВидДокумента + ВЫБОР
               |					КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.СчетФактураВыданный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
               |							И НЕ ВЫРАЗИТЬ(DR_События.Документ КАК Документ.СчетФактураВыданный).Исправление
               |						ТОГДА ""_Кор.""
               |					КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.СчетФактураВыданный).Исправление
               |						ТОГДА ""_Испр.""
               |					ИНАЧЕ """"
               |				КОНЕЦ
               |		ИНАЧЕ DR_События.ВидДокумента
               |	КОНЕЦ КАК ВидДокумента,
               |	ЕСТЬNULL(ВТ_Квитанции_ЮЗД.Документ, DR_События.Документ) КАК Документ,
               |	ВЫБОР
               |		КОГДА DR_События.ВидДокумента В (&ВидыДокументовКвитанций)
               |			ТОГДА ВТ_Квитанции_ЮЗД.ИдентификаторДляКвитанций
               |		ИНАЧЕ DR_События.Идентификатор
               |	КОНЕЦ КАК Идентификатор,
               |	DR_События.ИдентификаторОснования КАК ИдентификаторОснования,
               |	ЕСТЬNULL(ВТ_Квитанции_ЮЗД.Документ, DR_События.Документ) КАК ПредставлениеДокумента,
               |	""Поставщик"" КАК DR_ТипОбмена,
               |	"""" КАК ИдентификаторЮЗД
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События
               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Квитанции_ЮЗД КАК ВТ_Квитанции_ЮЗД
               |		ПО DR_События.Идентификатор = ВТ_Квитанции_ЮЗД.Идентификатор
               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ВидыДокументов КАК ВТ_ВидыДокументов
               |		ПО DR_События.ВидДокумента = ВТ_ВидыДокументов.Имя
               |ГДЕ
               |	DR_События.ИдентификаторЦепочки = &ИдентификаторЦепочки
			   |	И РАЗНОСТЬДАТ(&ДатаЗаказа, DR_События.ДатаЗаписи, ДЕНЬ) МЕЖДУ 0 И &ПериодСвязиДокументов
               |	И НЕ DR_События.ВидДокумента В (""DP_PDPOL_02_Входящий"", ""DP_PDPOL_07_Входящий"", ""DP_PDPOL_12_Входящий"", ""DP_PDOTPR_03_Входящий"", ""DP_PDOTPR_08_Входящий"", ""DP_PDOTPR_13_Входящий"", ""DP_PDPOL_14_Входящий"", ""DP_PDOTPR_15_Входящий"")
               |
               |УПОРЯДОЧИТЬ ПО
               |	DR_События.ДатаЗаписи";

ВидыДокументовЮЗД = ПолучитьМассивВидыДокументовЮЗД();
ВидыДокументовКвитанций = ПолучитьМассивВидыДокументовКвитанций();
	
Запрос.УстановитьПараметр("ВидыДокументовЮЗД", ВидыДокументовЮЗД);
Запрос.УстановитьПараметр("ВидыДокументовКвитанций", ВидыДокументовКвитанций);