<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ИмяКнопки</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Формула</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Регламент</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Создать счет-фактуру полученный</Value>
		<Value xsi:type="xs:string">СоздатьСчетФактуруПолученный</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">//&lt;служебные переменные&gt;
ТипПриемника  = "СчетФактураПолученный";
ИмяСобытия 	  = "Создание документов по кнопке &lt;&lt;&lt; Создать счет-фактуру полученный &gt;&gt;&gt;";

ОперацияЗапись = Ложь;
ЛогСобытий	   = "";
	
ВыбранныеСтроки	= ?(ВыбранныеСтроки = Неопределено, Новый Массив, ВыбранныеСтроки);
//&lt;/служебные переменные&gt;

КвалификаторСтрок = Новый КвалификаторыСтроки(36);

ТаблицаВыбранныхЗаписей = Новый ТаблицаЗначений;
ТаблицаВыбранныхЗаписей.Колонки.Добавить("Документ"				, Новый ОписаниеТипов("ДокументСсылка.DR_Документ"));
ТаблицаВыбранныхЗаписей.Колонки.Добавить("ИдентификаторЦепочки"	, Новый ОписаниеТипов("Строка",,,,КвалификаторСтрок));

Для Каждого Элемент Из ВыбранныеСтроки Цикл
	НоваяСтрока = ТаблицаВыбранныхЗаписей.Добавить();
	ЗаполнитьЗначенияСвойств(НоваяСтрока, Элемент);
КонецЦикла;

Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ
               |	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	ВыбранныеЗаписи.Документ КАК Документ
               |ПОМЕСТИТЬ ВыбранныеЗаписи
               |ИЗ
               |	&amp;ТаблицаВыбранныхЗаписей КАК ВыбранныеЗаписи
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	ВыбранныеЗаписи.Документ КАК Источник,
               |	ВыбранныеЗаписи.Документ.Статус КАК СтатусИсточник,        
               |	ВЫРАЗИТЬ(ВыбранныеЗаписи.Документ КАК Документ.DR_Документ).ИдентификаторДокумента КАК Идентификатор,
               |	ВЫБОР
               |		КОГДА DR_НомерИсправления.Значение ЕСТЬ NULL
               |			ТОГДА """"
               |		КОГДА DR_НомерИсправления.Значение = ""-""
               |			ТОГДА """"
               |		ИНАЧЕ DR_НомерИсправления.Значение
               |	КОНЕЦ КАК НомерИсправления,
               |	ЕСТЬNULL(DR_ДатаИсправления.Значение, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаИсправления,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(ВыбранныеЗаписи.Документ КАК Документ.DR_Документ).ВидДокумента В (""ON_NSCHFDOPPR_01_Входящий"", ""ON_NSCHFDOPPRMARK_01_Входящий"", ""ON_NSCHFDOPPRPROS_01_Входящий"", ""ON_NSCHFDOPPR_01_Испр_Входящий"", ""ON_NSCHFDOPPRMARK_01_Испр_Входящий"", ""ON_NSCHFDOPPRPROS_01_Испр_Входящий"")
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК ЭтоУПД,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(ВыбранныеЗаписи.Документ КАК Документ.DR_Документ).ВидДокумента В (""ON_NSCHFDOPPR_01_Испр_Входящий"", ""ON_NSCHFDOPPRMARK_01_Испр_Входящий"", ""ON_NSCHFDOPPRPROS_01_Испр_Входящий"")
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК Исправленный,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(ВыбранныеЗаписи.Документ КАК Документ.DR_Документ).ВидДокумента В (""ON_NKORSCHFDOPPR_01_Входящий"", ""ON_NKORSCHFDOPPRMARK_01_Входящий"", ""ON_NKORSCHFDOPPRPROS_01_Входящий"")
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК Корректировочный,
               |	ВЫРАЗИТЬ(ВыбранныеЗаписи.Документ КАК Документ.DR_Документ).Дата КАК ИсточникДата,
               |	ВЫРАЗИТЬ(ВыбранныеЗаписи.Документ КАК Документ.DR_Документ).Номер КАК ИсточникНомер,
			   |	DR_ИнфПолФХЖ1.ХранилищеЗначения КАК ЗначениеИнфПолФХЖ1
               |ИЗ
               |	ВыбранныеЗаписи КАК ВыбранныеЗаписи
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_НомерИсправления
               |		ПО ВыбранныеЗаписи.Документ = DR_НомерИсправления.Ссылка
               |			И (DR_НомерИсправления.Реквизит = ""Документ_СвСчФакт_ИспрСчФ_НомИспрСчФ"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_ДатаИсправления
               |		ПО ВыбранныеЗаписи.Документ = DR_ДатаИсправления.Ссылка
               |			И (DR_ДатаИсправления.Реквизит = ""Документ_СвСчФакт_ИспрСчФ_ДатаИспрСчФ"")
			   |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_ИнфПолФХЖ1
               |		ПО ВыбранныеЗаписи.Документ = DR_ИнфПолФХЖ1.Ссылка
               |			И (DR_ИнфПолФХЖ1.Реквизит = ""Документ_СвСчФакт_ИнфПолФХЖ1"")
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_Накладная.Документ КАК Накладная,
               |	DR_Накладная.Документ.ДатаВходящегоДокумента КАК ДатаВходящегоДокумента,
               |	DR_Накладная.Документ.НомерВходящегоДокумента КАК НомерВходящегоДокумента
               |ИЗ
               |	ВыбранныеЗаписи КАК ВыбранныеЗаписи
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_Накладная
               |		ПО ВыбранныеЗаписи.ИдентификаторЦепочки = DR_Накладная.ИдентификаторЦепочки
               |			И (DR_Накладная.ВидДокумента = ""Накладная_Входящая"")
               |ГДЕ
               |	НЕ DR_Накладная.Документ ЕСТЬ NULL
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_Накладная.Документ КАК Накладная,
               |	DR_Накладная.Документ.ДатаВходящегоДокумента КАК ДатаВходящегоДокумента,
               |	DR_Накладная.Документ.НомерВходящегоДокумента КАК НомерВходящегоДокумента,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(DR_Накладная.Документ КАК Документ.КорректировкаПоступления).ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийИсправленияПоступленияРеализации.ИсправлениеОшибки)
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК Исправление
               |ИЗ
               |	ВыбранныеЗаписи КАК ВыбранныеЗаписи
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_Накладная
               |		ПО ВыбранныеЗаписи.ИдентификаторЦепочки = DR_Накладная.ИдентификаторЦепочки
               |			И (DR_Накладная.ВидДокумента = ""КорректировочнаяНакладная_Входящая"")
               |ГДЕ
               |	НЕ DR_Накладная.Документ ЕСТЬ NULL
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВыбранныеЗаписи.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_СчетФактура.Документ КАК СчетФактура,
               |	DR_СчетФактура.ИдентификаторОснования КАК ИдентификаторОснования,
               |	DR_ДокументыОснования.ДокументОснование КАК ДокументОснование,
               |	ВЫРАЗИТЬ(DR_СчетФактура.Документ КАК Документ.СчетФактураПолученный).Исправление КАК Исправленный,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(DR_СчетФактура.Документ КАК Документ.СчетФактураПолученный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.Корректировочный)
               |			ТОГДА ИСТИНА
               |		ИНАЧЕ ЛОЖЬ
               |	КОНЕЦ КАК Корректировочный,
               |	СТРОКА(ВЫРАЗИТЬ(DR_СчетФактура.Документ КАК Документ.СчетФактураПолученный).НомерИсправления) КАК НомерИсправления,
               |	ВЫРАЗИТЬ(ВЫРАЗИТЬ(DR_СчетФактура.Документ КАК Документ.СчетФактураПолученный).ДатаИсправления КАК ДАТА) КАК ДатаИсправления
               |ИЗ
               |	ВыбранныеЗаписи КАК ВыбранныеЗаписи
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_СчетФактура
               |		ПО ВыбранныеЗаписи.ИдентификаторЦепочки = DR_СчетФактура.ИдентификаторЦепочки
               |			И (DR_СчетФактура.ВидДокумента = ""СчетФактура_Входящий"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный.ДокументыОснования КАК DR_ДокументыОснования
               |		ПО (DR_СчетФактура.Документ = DR_ДокументыОснования.Ссылка)
               |ГДЕ
               |	НЕ DR_СчетФактура.Документ ЕСТЬ NULL";

Запрос.УстановитьПараметр("ТаблицаВыбранныхЗаписей", ТаблицаВыбранныхЗаписей);

Пакет = Запрос.ВыполнитьПакет(); 
Выборка   = Пакет[1].Выбрать();  
Накладные = Пакет[2].Выгрузить();
Накладные.Индексы.Добавить("ИдентификаторЦепочки");
КорНакладные = Пакет[3].Выгрузить();
КорНакладные.Индексы.Добавить("ИдентификаторЦепочки");
СчФактуры = Пакет[4].Выгрузить();
СчФактуры.Индексы.Добавить("ИдентификаторЦепочки, ИдентификаторОснования");
СчФактуры.Индексы.Добавить("ДокументОснование");
ИмяДокументаПриемника = "Счет-фактура полученный 1С";

Пока Выборка.Следующий() Цикл 
	
	Если Выборка.СтатусИсточник = "НеОбработан" Тогда
	
		ТекстЛогаСобытий = "Не создан документ ""Счет-фактура"", т.к. документ УПД в статусе ""не обработан"".";                          
		ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Ошибка", ИмяСобытия);			
		МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
		
		Продолжить;
		
	КонецЕсли;               
               
	Если Выборка.ЭтоУПД 
		 И НЕ Выборка.Исправленный Тогда
		 
		    СтруктураПоиска = Новый Структура("ИдентификаторЦепочки, ИдентификаторОснования, Исправленный", Выборка.ИдентификаторЦепочки, Выборка.Идентификатор, Ложь);
			СтрокиСчФактуры = СчФактуры.НайтиСтроки(СтруктураПоиска);		
			Если СтрокиСчФактуры.Количество() &gt; 0  Тогда
				ТекстЛогаСобытий = ИмяДокументаПриемника + " по документу " + Строка(Выборка.Источник) + " уже создана";
				ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
				МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
				Продолжить;	
			КонецЕсли;
							
	КонецЕсли;
	
	Накладная = Неопределено;
	КомментарийДополение = "";
	НеобходимаПроверкаПервичнойСчф = Ложь;
	
	Если НЕ Выборка.ЭтоУПД 
		 ИЛИ (Выборка.ЭтоУПД И Выборка.Исправленный) Тогда
		 Накладные = КорНакладные;
		 КомментарийДополение = "корректировочная";
		 НеобходимаПроверкаПервичнойСчф = Истина;
	КонецЕсли;	
		
	СтрокиНакладные = Накладные.НайтиСтроки(Новый Структура("ИдентификаторЦепочки", Выборка.ИдентификаторЦепочки)); 
	
	//Если несколько накладных, считаем что это разделенная цепочка, ищем нужную накладную по номеру и дате.
	Если СтрокиНакладные.Количество() > 1 Тогда
		
		ЗначениеИзХранилища = Выборка.ЗначениеИнфПолФХЖ1.Получить();
						
		Если ЗначениеЗаполнено(ЗначениеИзХранилища) Тогда
			
			ИнфоПоля = ЗначениеИзХранилища[0];
			
			Если ИнфоПоля.Свойство("Дата_накладной") И ИнфоПоля.Свойство("Номер_накладной") Тогда
				
				Номер_накладной = ИнфоПоля.Номер_накладной;
				Дата_накладной = ИнфоПоля.Дата_накладной;
			    
			    КолвоЭлементов = СтрокиНакладные.Количество();
		        Индекс = 0;
		        
		        Для н = 1 По КолвоЭлементов Цикл
		        	
		        	Индекс = КолвоЭлементов - н;
		        	
		        	СтрокаНакладная = СтрокиНакладные[Индекс];
					Если НЕ Формат(СтрокаНакладная.ДатаВходящегоДокумента, "ДЛФ=Д") = Дата_накладной ИЛИ НЕ СтрокаНакладная.НомерВходящегоДокумента = Номер_накладной Тогда
						СтрокиНакладные.Удалить(Индекс);
					КонецЕсли	
		               
		        КонецЦикла
			КонецЕсли;
			
		КонецЕсли;
	
	КонецЕсли;
	
	Если СтрокиНакладные.Количество() = 1 Тогда 
		
		СтрокаТЗНакладные = СтрокиНакладные.Получить(0);
		СтруктураПоиска = Новый Структура("ДокументОснование", СтрокаТЗНакладные.Накладная);
		
		Если Выборка.Исправленный Тогда
		     СтруктураПоиска.Вставить("Исправленный", Истина);
		ИначеЕсли Выборка.Корректировочный Тогда
			 СтруктураПоиска.Вставить("Исправленный", Ложь);
		КонецЕсли;
		 
		СтрокиСчФактуры = СчФактуры.НайтиСтроки(СтруктураПоиска);
		
		Если СтрокиСчФактуры.Количество() = 0 Тогда	
			
			Если НеобходимаПроверкаПервичнойСчф Тогда
				
				ТекстЗапроса = "ВЫБРАТЬ
				               |	СчетФактураПолученный.Ссылка КАК СчетФактураПервичный
				               |ИЗ
				               |	Документ.КорректировкаПоступления КАК КорректировкаПоступления
				               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровУслуг КАК ПоступлениеТоваровУслуг
				               |		ПО КорректировкаПоступления.ДокументПоступления = ПоступлениеТоваровУслуг.Ссылка
				               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученный КАК СчетФактураПолученный
				               |		ПО (ПоступлениеТоваровУслуг.Ссылка = СчетФактураПолученный.ДокументОснование)
				               |ГДЕ
				               |	КорректировкаПоступления.Ссылка = &amp;Ссылка
				               |	И НЕ СчетФактураПолученный.Ссылка ЕСТЬ NULL";
				
				Запрос = Новый Запрос;
				Запрос.Текст = ТекстЗапроса;
				Запрос.УстановитьПараметр("Ссылка", СтрокаТЗНакладные.Накладная);
				
				РезультатЗапроса = Запрос.Выполнить();
				Если РезультатЗапроса.Пустой() Тогда
					
					ТекстЛогаСобытий = "Для документа " + Строка(СтрокаТЗНакладные.Накладная) + " не создана первичная Счет-фактура в цепочке. Обработка прекращена.";
					ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
					МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
					Продолжить;
					
				КонецЕсли;	
				
			КонецЕсли;
				
			Накладная = СтрокаТЗНакладные.Накладная;   
			ДатаВходящегоДокумента  = ?(ЗначениеЗаполнено(СтрокаТЗНакладные.ДатаВходящегоДокумента), СтрокаТЗНакладные.ДатаВходящегоДокумента, Выборка.ИсточникДата);
			НомерВходящегоДокумента = ?(ЗначениеЗаполнено(СтрокаТЗНакладные.НомерВходящегоДокумента), СтрокаТЗНакладные.НомерВходящегоДокумента, Выборка.ИсточникНомер);
	        
		Иначе 
			ТекстЛогаСобытий = ИмяДокументаПриемника + " по документу " + Строка(Выборка.Источник) + " не создан, уже существует для накладной. ";
			ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
			МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
			Продолжить;	
		КонецЕсли;
			
		
	ИначеЕсли СтрокиНакладные.Количество() &gt; 1 Тогда
		ТекстЛогаСобытий = ИмяДокументаПриемника + " по документу " + Строка(Выборка.Источник) + " не создан, обнаружено более одной накладной. ";
		ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
		МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
		Продолжить; 
		
	ИначеЕсли СтрокиНакладные.Количество() = 0 Тогда 
		ТекстЛогаСобытий = ИмяДокументаПриемника + " по документу " + Строка(Выборка.Источник) + " не создан, не обнаружена " + КомментарийДополение + " накладная. ";
		ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
		МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
		Продолжить; 
		
	КонецЕсли;
			
	Приемник = Документы[ТипПриемника].СоздатьДокумент();
	
	//Выполняется через проверку переменной для удобства чтения.
	Если Накладная &lt;&gt; Неопределено Тогда
		Если Не Накладная.ОтражатьВБухгалтерскомУчете Тогда
			ТекстЛогаСобытий = "Счет-фактуру по документу " + Строка(Выборка.Источник) + " нельзя вводить на основании поступления, не отражаемого в бухгалтерском учете";
			ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
			МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
			Продолжить;
		КонецЕсли;
		
		//Попытаемся найти счет-фактуру
		СчетФактура = УчетНДС.НайтиПодчиненныйДокумент(Накладная, "СчетФактураПолученный", Истина);
		Если СчетФактура &lt;&gt; Неопределено Тогда
			Приемник = СчетФактура.ПолучитьОбъект();
			Приемник.ДокументыОснования.Очистить();
		КонецЕсли;
				
		Приемник.Заполнить(Накладная);
		Приемник.Дата = ТекущаяДата();
		Приемник.НомерВходящегоДокумента = НомерВходящегоДокумента;
		Приемник.ДатаВходящегоДокумента =  ДатаВходящегоДокумента;
		Приемник.КодСпособаПолучения = 2;
		
		Если Выборка.Исправленный Тогда 
		    Приемник.Исправление 		= Истина;
			Приемник.НомерИсправления   = Выборка.НомерИсправления;
			Приемник.ДатаИсправления    = Выборка.ДатаИсправления;
		КонецЕсли;
		
		Если Выборка.Корректировочный Тогда
			Приемник.ВидСчетаФактуры  = Перечисления.ВидСчетаФактурыПолученного.Корректировочный;
		КонецЕсли;				
				
		Если Приемник.ДокументыОснования.Количество() = 0 Тогда
			НовСтрока = Приемник.ДокументыОснования.Добавить();
			НовСтрока.ДокументОснование = Накладная;
		КонецЕсли;
		
	Иначе 
		Продолжить;
	КонецЕсли;
	
	СоздаватьДокумент1СПроведенным = Настройка_Параметр_Прочитать("EDI_СоздаватьДокументПолученныйСЧФ1СПроведенным", Ложь); 
	
	ОшибокНеОбнаружено = Приемник.ПроверитьЗаполнение();

	Если ОшибокНеОбнаружено Тогда
		Попытка
			Приемник.Записать(?(СоздаватьДокумент1СПроведенным, РежимЗаписиДокумента.Проведение, РежимЗаписиДокумента.Запись));
		Исключение
			Приемник.Записать(РежимЗаписиДокумента.Запись);
			ТекстЛогаСобытий = ИмяДокументаПриемника + " по документу " + Строка(Выборка.Источник) + " не создано!!! " + СокрЛП(ОписаниеОшибки()); 
			ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Информация", ИмяСобытия);
			МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога); 
		КонецПопытки;  
		
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Приемник.Ссылка) Тогда
		ВидДокументаПриемник = "СчетФактура_Входящий";	
		
		СтруктураРегистраDR_События = Новый Структура;
		СтруктураРегистраDR_События.Вставить("ИдентификаторЦепочки"		, Выборка.ИдентификаторЦепочки);
		СтруктураРегистраDR_События.Вставить("Документ"					, Приемник.Ссылка);
		СтруктураРегистраDR_События.Вставить("ВидДокумента"				, ВидДокументаПриемник);
		СтруктураРегистраDR_События.Вставить("Идентификатор"			, Приемник.Ссылка.УникальныйИдентификатор());
		СтруктураРегистраDR_События.Вставить("ИдентификаторОснования"	, Выборка.Идентификатор);
		СтруктураРегистраDR_События.Вставить("ДатаЗаписи"				, ТекущаяДата());
		DR_EDI_ОбщегоНазначения.Записать_DR_События(СтруктураРегистраDR_События);
		
	КонецЕсли;
	
	// служебные операции
	Если ЗначениеЗаполнено(Приемник.Ссылка) И Не ОперацияЗапись Тогда 
		КоличествоСозданныхДокументов = КоличествоСозданныхДокументов + 1;
	КонецЕсли;
	
КонецЦикла;</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">5</lastId>
			<item>
				<value xsi:type="xs:string">Неструкт. докум.</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<presentation>СписокOnNschfdopprВходящиеПокупатель; СписокOnNkorschfdopprВходящиеПокупатель; СписокOnNschfdopprИспрВходящиеПокупатель</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">Синоним</value>
				<presentation>Создать счет-фактуру полученный</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>СоздатьСчетФактуруПолученный</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">5</id>
			</item>
		</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">1</lastId>
			<item>
				<value xsi:type="xs:string"/>
				<presentation>ТекстЗапроса</presentation>
				<id xsi:type="xs:decimal">0</id>
			</item>
		</Value>
	</row>
</ValueTree>