ТипДокументаЗаказа = "ДокументСсылка.ЗаказПоставщику";
ТипДокументаПоступления = "ДокументСсылка.ПриобретениеТоваровУслуг";
ТипДокументаСчетФактуры = "ДокументСсылка.СчетФактураПолученный";
ТипДокументаВозвратПоставщику = "ДокументСсылка.ВозвратТоваровПоставщику";

ИмяОрганизации = "Организация";
ИмяКонтрагента = "Контрагент";
ИмяТочкиДоставки = "Склад";
ИмяДатаПоставки = "ЖелаемаяДатаПоступления";
ДатаЗаказа1С = "ДатаПоДаннымКлиента";
НомерЗаказа1С = "НомерПоДаннымКлиента";
НомерВходящегоДокумента = "НомерВходящегоДокумента";
ДатаВходящегоДокумента = "ДатаВходящегоДокумента";
ИмяЗаказа1С = "ЗаказПоставщику";
ОснованиеВозвратаПоставщику = "ДокументПоступления";

// Заказ поставщику
Если ТипЗнч(Источник.Ссылка) = Тип(ТипДокументаЗаказа) Тогда
    
    ВыборкаУчастниковВЭДО = DR_EDI_ОбщегоНазначения.КонтрагентУчаствуетВЭДО(Источник[ИмяОрганизации], Источник[ИмяКонтрагента], Источник[ИмяТочкиДоставки]);
    Если ВыборкаУчастниковВЭДО.Количество() > 0 Тогда          
          
        Запрос = Новый Запрос;
        Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1
                       |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки
                       |ИЗ
                       |	РегистрСведений.DR_События КАК DR_События
                       |ГДЕ
                       |	DR_События.Документ = &Документ";
        Запрос.УстановитьПараметр("Документ", Источник.Ссылка);
        РезультатЗапроса = Запрос.Выполнить(); 
                                       
        Если РезультатЗапроса.Пустой() Тогда
	        ИдентификаторДокумента = Источник.Ссылка.УникальныйИдентификатор();
	         
	        СтруктураСобытия = Новый Структура("Документ, ВидДокумента, ИдентификаторЦепочки, Идентификатор, Статус" , Источник.Ссылка, "Заказ_Исходящий", ИдентификаторДокумента, 
	        	ИдентификаторДокумента, "ГотовКотправке"); 
	        
	        СтруктураЦепочки = Новый Структура("ДатаЗаказа, ИдентификаторЦепочки, ДатаПоставки, НомерЗаказа, Организация, Контрагент, ТочкаДоставки", Источник.Дата, ИдентификаторДокумента,  
	        Источник.ДатаПоступления, Источник.Номер, Источник[ИмяОрганизации], Источник[ИмяКонтрагента], Источник[ИмяТочкиДоставки]); 
	        
	        DR_EDI_ОбщегоНазначения.Записать_DR_События(СтруктураСобытия);
	        DR_EDI_ОбщегоНазначения.Записать_DR_ЦепочкиДокументов(СтруктураЦепочки); 
        КонецЕсли;           
                                                                                
    КонецЕсли;
    
КонецЕсли;