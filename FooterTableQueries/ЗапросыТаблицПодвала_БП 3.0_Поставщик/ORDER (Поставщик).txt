ВЫБРАТЬ
	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
	DR_События.Документ КАК Документ,
	DR_События.Идентификатор КАК Идентификатор,
	DR_События.ИдентификаторОснования КАК ИдентификаторОснования,
	DR_События.ДатаСообщения КАК ДатаСообщения,
	DR_События.Статус КАК Статус,
	DR_События.Сообщение КАК Сообщение,
	DR_События.ДатаЗаписи КАК ДатаЗаписи,
	ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).АктуальныйДокумент КАК Актуальный,
	ВЫБОР
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента = "O"
			ТОГДА "Оригинал"
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента = "R"
			ТОГДА "Замена"
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента = "D"
			ТОГДА "Удаление"
		ИНАЧЕ "Оригинал"
	КОНЕЦ КАК Тип,
	ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ЭтоПовторныйДокумент КАК Повторный,
	МАКСИМУМ(ВЫБОР
			КОГДА Заказ_События.Документ ЕСТЬ NULL
				ТОГДА ЛОЖЬ
			КОГДА Заказ_События.Документ = ЗНАЧЕНИЕ(Документ.СчетНаОплатуПокупателю.ПустаяСсылка)
				ТОГДА ЛОЖЬ
			ИНАЧЕ ИСТИНА
		КОНЕЦ) КАК СозданЗаказБулево,
	СУММА(ЭКОМ_ДокументыТЧ_Товары.КоличествоЗаказанное) КАК КоличествоЗаказанное,
	ВЫБОР
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ПометкаУдаления
			ТОГДА 2
		ИНАЧЕ 1
	КОНЕЦ КАК Документ__КартинкаСтатус
ИЗ
	РегистрСведений.DR_События КАК DR_События
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК Заказ_События
		ПО (DR_События.ИдентификаторЦепочки = Заказ_События.ИдентификаторЦепочки)
			И (Заказ_События.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.Заказ_Входящий))
			И (DR_События.Идентификатор = Заказ_События.ИдентификаторОснования)
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭКОМ_Документы.ТЧ_Товары КАК ЭКОМ_ДокументыТЧ_Товары
		ПО (DR_События.Документ = ЭКОМ_ДокументыТЧ_Товары.Ссылка)
ГДЕ
	DR_События.ИдентификаторЦепочки В(&ИдентификаторЦепочки)
	И DR_События.ВидДокумента = ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.ORDER_Входящий)

СГРУППИРОВАТЬ ПО
	DR_События.ДатаЗаписи,
	DR_События.ИдентификаторЦепочки,
	DR_События.ВидДокумента,
	DR_События.Идентификатор,
	DR_События.Документ,
	DR_События.ИдентификаторОснования,
	DR_События.ДатаСообщения,
	DR_События.Статус,
	DR_События.Сообщение,
	ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).АктуальныйДокумент,
	ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента,
	ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ЭтоПовторныйДокумент,
	ВЫБОР
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ПометкаУдаления
			ТОГДА 2
		ИНАЧЕ 1
	КОНЕЦ,
	ВЫБОР
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента = "O"
			ТОГДА "Оригинал"
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента = "R"
			ТОГДА "Замена"
		КОГДА ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ЭКОМ_Документы).ТипДокумента = "D"
			ТОГДА "Удаление"
		ИНАЧЕ "Оригинал"
	КОНЕЦ