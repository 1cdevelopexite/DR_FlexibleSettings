<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Данные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ИмяКнопки</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Регламент</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Исходящий УКД (Мастер кнопка)</Value>
		<Value xsi:type="xs:string">МассивСтруктурИсходящих = Новый Массив;

Запрос = Новый Запрос;
Запрос.Текст = 
"ВЫБРАТЬ
|	СчетФактураВыданный.Ссылка КАК Ссылка,
|	ВЫБОР
|		КОГДА СчетФактураВыданный.ДокументОснование ССЫЛКА Документ.КорректировкаРеализации
|			ТОГДА ВЫРАЗИТЬ(СчетФактураВыданный.ДокументОснование КАК Документ.КорректировкаРеализации)
|		ИНАЧЕ ВЫРАЗИТЬ(СчетФактураВыданный.ДокументОснование КАК Документ.ВозвратТоваровОтПокупателя)
|	КОНЕЦ КАК ДокументОснование
|ПОМЕСТИТЬ ВремТабл
|ИЗ
|	Документ.СчетФактураВыданный КАК СчетФактураВыданный
|ГДЕ
|	СчетФактураВыданный.Ссылка В(&amp;Источник)
|	И СчетФактураВыданный.ПометкаУдаления = ЛОЖЬ
|	И СчетФактураВыданный.ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
|	И СчетФактураВыданный.Исправление = ЛОЖЬ
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|	СчетФактураВыданный.Ссылка КАК СчФ
|ИЗ
|	ВремТабл КАК СчетФактураВыданный
|ГДЕ
|	СчетФактураВыданный.ДокументОснование ССЫЛКА Документ.КорректировкаРеализации
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|	СчетФактураВыданный.Ссылка КАК СчФ
|ИЗ
|	ВремТабл КАК СчетФактураВыданный
|ГДЕ
|	СчетФактураВыданный.ДокументОснование ССЫЛКА Документ.ВозвратТоваровОтПокупателя";

Запрос.УстановитьПараметр("Источник", Источник);

РезультатЗапроса = Запрос.ВыполнитьПакет();

МассивУКДКорРТУ  		= РезультатЗапроса[1].Выгрузить().ВыгрузитьКолонку("СчФ");
МассивУКДВозвратТов  	= РезультатЗапроса[2].Выгрузить().ВыгрузитьКолонку("СчФ");

Если МассивУКДКорРТУ.Количество() &lt;&gt; 0 Тогда
	
	ИмяКолонки = "";
	СтруктураФайлаДанных = Неопределено;
	
	//&lt;Поиск сценария&gt;
	СценарийСозданияXMLУКД = Настройка_Параметр_Прочитать("EDI_СтруктураФайлаXMLИсходящие");
	СтрокиНастроекПоОтбору = СценарийСозданияXMLУКД.Строки.НайтиСтроки(Новый Структура("Использовать, ИмяКнопки", Истина, "ИсходящийУКДКорректировкаРеализации"));
	
	Если СтрокиНастроекПоОтбору.Количество() Тогда
		//&lt;Используется первый найденный шаблон с признаком "Использовать"&gt;
		СтруктураФайлаДанных = СтрокиНастроекПоОтбору[0];
		
	КонецЕсли;
	
	Если СтруктураФайлаДанных &lt;&gt; Неопределено Тогда					
		
		ГибкиеНастройки = СтрЗаменить(СтруктураФайлаДанных.Служебные, "Источник", "МассивУКДКорРТУ"); 
		
		//&lt;Переменная для определения контекста выполняемого сценария&gt;
		ГибкиеНастройки = "ВызовМастерКнопкойУКД = Истина;" + Символы.ПС + ГибкиеНастройки;
		
		//&lt;выполнение подготовленного сценария&gt;
		Выполнить(ГибкиеНастройки); 
		
	КонецЕсли;
	
КонецЕсли;

Если МассивУКДВозвратТов.Количество() &lt;&gt; 0 Тогда
	
	ИмяКолонки = "";
	СтруктураФайлаДанных = Неопределено;
	
	//&lt;Поиск сценария&gt;
	СценарийСозданияXMLУКД = Настройка_Параметр_Прочитать("EDI_СтруктураФайлаXMLИсходящие");
	СтрокиНастроекПоОтбору = СценарийСозданияXMLУКД.Строки.НайтиСтроки(Новый Структура("Использовать, ИмяКнопки", Истина, "ИсходящийУКДВозврат"));
	
	Если СтрокиНастроекПоОтбору.Количество() Тогда
		
		СтруктураФайлаДанных = СтрокиНастроекПоОтбору[0];
		
	КонецЕсли;
	
	Если СтруктураФайлаДанных &lt;&gt; Неопределено Тогда					
		
		ГибкиеНастройки = СтрЗаменить(СтруктураФайлаДанных.Служебные, "Источник", "МассивУКДВозвратТов"); 
		
		//&lt;Переменная для определения контекста выполняемого сценария&gt;
		ГибкиеНастройки = "ВызовМастерКнопкойУКД = Истина;" + Символы.ПС + ГибкиеНастройки;
		
		//&lt;выполнение подготовленного сценария&gt;
		Выполнить(ГибкиеНастройки); 
		
	КонецЕсли;
	
КонецЕсли;

Возврат МассивСтруктурИсходящих;</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">Исходящий УКД</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">8</lastId>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<presentation>СписокКорректировочныеСчетаФактурыИсходящиеПоставщик</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Синоним</value>
				<presentation>Исходящий УКД</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>ИсходящийУКД</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ПередаватьТекстПричины</value>
				<id xsi:type="xs:decimal">5</id>
			</item>
			<item>
				<value xsi:type="xs:string">ПриемникВидДокумента</value>
				<presentation>ON_NKORSCHFDOPPR_01_Исходящий; ON_NKORSCHFDOPPRMARK_01_Исходящий; ON_NKORSCHFDOPPRPROS_01_Исходящий</presentation>
				<id xsi:type="xs:decimal">6</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИсточникВидДокумента</value>
				<presentation>СчетФактура_Исходящий</presentation>
				<id xsi:type="xs:decimal">7</id>
			</item>
			<item>
				<value xsi:type="xs:string">НужнаПодпись</value>
				<presentation>Да</presentation>
				<id xsi:type="xs:decimal">8</id>
			</item>
		</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">ИсходящийУКД</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">1</lastId>
			<item>
				<value xsi:type="xs:string">ТекстЗапроса = "ВЫБРАТЬ
               |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_События.Документ КАК Документ,
               |	DR_События.Идентификатор КАК Идентификатор
               |ПОМЕСТИТЬ ВТ_КорСЧФ
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События
               |ГДЕ
               |	DR_События.ВидДокумента = ""СчетФактура_Исходящий""
               |	И ВЫРАЗИТЬ(DR_События.Документ КАК Документ.СчетФактураВыданный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
               |	И НЕ ВЫРАЗИТЬ(DR_События.Документ КАК Документ.СчетФактураВыданный).Исправление
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_События.ИдентификаторОснования КАК ИдентификаторОснования,
               |	DR_События.Документ КАК Документ,
               |	МАКСИМУМ(DR_События.ДатаЗаписи) КАК ДатаЗаписи
               |ПОМЕСТИТЬ ВТ_Кор_NSCHFDOPPR
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События
               |ГДЕ
               |	(DR_События.ВидДокумента = ""ON_NKORSCHFDOPPR_01_Исходящий""
               |			ИЛИ DR_События.ВидДокумента = ""ON_NKORSCHFDOPPRMARK_01_Исходящий""
               |			ИЛИ DR_События.ВидДокумента = ""ON_NKORSCHFDOPPRPROS_01_Исходящий"")
               |
               |СГРУППИРОВАТЬ ПО
               |	DR_События.ИдентификаторЦепочки,
               |	DR_События.ИдентификаторОснования,
               |	DR_События.Документ
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ ПЕРВЫЕ 2
               |	ВТ_КорСЧФ.Документ КАК Документ,
               |	""СчетФактура_Исходящий"" КАК ВидДокумента,
               |	"""" КАК СтатусОбработкиДокумента
               |ИЗ
               |	ВТ_КорСЧФ КАК ВТ_КорСЧФ
               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Кор_NSCHFDOPPR КАК ВТ_Кор_NSCHFDOPPR
               |		ПО ВТ_КорСЧФ.ИдентификаторЦепочки = ВТ_Кор_NSCHFDOPPR.ИдентификаторЦепочки
               |			И ВТ_КорСЧФ.Идентификатор = ВТ_Кор_NSCHFDOPPR.ИдентификаторОснования
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_ЦепочкиДокументов КАК DR_ЦепочкиДокументов
               |		ПО ВТ_КорСЧФ.ИдентификаторЦепочки = DR_ЦепочкиДокументов.ИдентификаторЦепочки
               |ГДЕ
               |	ВТ_КорСЧФ.Документ.Проведен
               |	И ВТ_Кор_NSCHFDOPPR.ИдентификаторЦепочки ЕСТЬ NULL
			   |
			   |УПОРЯДОЧИТЬ ПО
			   |	DR_ЦепочкиДокументов.ДатаЗаказа УБЫВ";</value>
				<presentation>ТекстЗапроса</presentation>
				<id xsi:type="xs:decimal">0</id>
			</item>
		</Value>
	</row>
</ValueTree>