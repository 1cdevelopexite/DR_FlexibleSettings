<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Атрибуты</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Данные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ДанныеЗначения</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ДоступныеЗначения</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Связи</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Обязательный</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ИмяКнопки</Name>
		<ValueType/>
	</column>
	<row>
		<row>
			<row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ЮЛ</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">5</lastId>
						<item>
							<value xsi:type="xs:string">НаимОрг</value>
							<presentation>Документ.УчастЭДО_НаимОрг</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">3</id>
						</item>
						<item>
							<value xsi:type="xs:string">ИННЮЛ</value>
							<presentation>Документ.УчастЭДО_ИННЮЛ</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">4</id>
						</item>
						<item>
							<value xsi:type="xs:string">КПП</value>
							<presentation>Документ.УчастЭДО_КПП</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">5</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string"/>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">УчастЭДО</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">1</lastId>
					<item>
						<value xsi:type="xs:string">ИдУчастЭДО</value>
						<presentation>Документ.УчастЭДО_ИдУчастЭДО</presentation>
						<checkState>1</checkState>
						<id xsi:type="xs:decimal">1</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:string"/>
			</row>
			<row>
				<row>
					<row>
						<Value xsi:type="xs:boolean">true</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="xs:string">ЭЦПАнФайл</Value>
						<Value xsi:nil="true"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:string">Документ.ЭЦПАнФайл</Value>
						<Value xsi:type="ValueTable"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:decimal">0</Value>
						<Value xsi:type="xs:decimal">0</Value>
						<Value xsi:type="xs:boolean">false</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:string"/>
					</row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">СведАнФайл</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">1</lastId>
						<item>
							<value xsi:type="xs:string">ИмяАнФайла</value>
							<presentation>Документ.ИмяАнФайла</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">1</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string"/>
				</row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ТекстПредАн</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string">Документ.ТекстПредАн</Value>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string"/>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">СвПредАн</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:string"/>
			</row>
			<row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ЮЛ</Value>
					<Value xsi:type="xs:string">ИспользоватьСтрокуДерева = Ложь;
Если  Документ.ТипПолучателя = "ЮЛ" Тогда
	ИспользоватьСтрокуДерева = Истина;
КонецЕсли;

Возврат ИспользоватьСтрокуДерева;</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">11</lastId>
						<item>
							<value xsi:type="xs:string">НаимОрг</value>
							<presentation>Документ.НапрПредАн_НаимОрг</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">9</id>
						</item>
						<item>
							<value xsi:type="xs:string">ИННЮЛ</value>
							<presentation>Документ.НапрПредАн_ИННЮЛ</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">10</id>
						</item>
						<item>
							<value xsi:type="xs:string">КПП</value>
							<presentation>Документ.НапрПредАн_КПП</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">11</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string"/>
				</row>
				<row>
					<row>
						<Value xsi:type="xs:boolean">true</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="xs:string">ФИО</Value>
						<Value xsi:nil="true"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">11</lastId>
							<item>
								<value xsi:type="xs:string">Фамилия</value>
								<presentation>Документ.НапрПредАн_ФамилияФЛ</presentation>
								<id xsi:type="xs:decimal">9</id>
							</item>
							<item>
								<value xsi:type="xs:string">Имя</value>
								<presentation>Документ.НапрПредАн_ИмяФЛ</presentation>
								<id xsi:type="xs:decimal">10</id>
							</item>
							<item>
								<value xsi:type="xs:string">Отчество</value>
								<presentation>Документ.НапрПредАн_ОтчествоФЛ</presentation>
								<id xsi:type="xs:decimal">11</id>
							</item>
						</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="ValueTable"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:decimal">0</Value>
						<Value xsi:type="xs:decimal">0</Value>
						<Value xsi:type="xs:boolean">false</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:string"/>
					</row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ИП</Value>
					<Value xsi:type="xs:string">ИспользоватьСтрокуДерева = Ложь;
Если  Документ.ТипПолучателя = "ИП" Тогда
	ИспользоватьСтрокуДерева = Истина;
КонецЕсли;

Возврат ИспользоватьСтрокуДерева;</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">2</lastId>
						<item>
							<value xsi:type="xs:string">ИННФЛ</value>
							<presentation>Документ.НапрПредАн_ИННЮЛ</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">2</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string"/>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">НапрПредАн</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">1</lastId>
					<item>
						<value xsi:type="xs:string">ИдУчастЭДО</value>
						<presentation>Документ.НапрПредАн_ИдУчастЭДО</presentation>
						<checkState>1</checkState>
						<id xsi:type="xs:decimal">1</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">false</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:string"/>
			</row>
			<row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ФИО</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">4</lastId>
						<item>
							<value xsi:type="xs:string">Имя</value>
							<presentation>Документ.Подписант_Имя</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">2</id>
						</item>
						<item>
							<value xsi:type="xs:string">Фамилия</value>
							<presentation>Документ.Подписант_Фамилия</presentation>
							<checkState>1</checkState>
							<id xsi:type="xs:decimal">3</id>
						</item>
						<item>
							<value xsi:type="xs:string">Отчество</value>
							<presentation>Документ.Подписант_Отчество</presentation>
							<id xsi:type="xs:decimal">4</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string"/>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">Подписант</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">1</lastId>
					<item>
						<value xsi:type="xs:string">Должность</value>
						<presentation>Документ.Подписант_Должность</presentation>
						<checkState>1</checkState>
						<id xsi:type="xs:decimal">1</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:string"/>
			</row>
			<Value xsi:type="xs:boolean">true</Value>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="xs:string">Документ</Value>
			<Value xsi:nil="true"/>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="ValueTable"/>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
			<Value xsi:type="xs:decimal">0</Value>
			<Value xsi:type="xs:decimal">0</Value>
			<Value xsi:type="xs:boolean">true</Value>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
			<Value xsi:type="xs:string"/>
		</row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Исходящий DP_PRANNUL_22 (покупатель - аннулирование)</Value>
		<Value xsi:type="xs:string">ЮЗД_входящий</Value>
		<Value xsi:type="xs:string">Файл</Value>
		<Value xsi:type="Structure">
			<Property name="ВидДокумента">
				<Value xsi:type="xs:string">Документ.ВидДокумента</Value>
			</Property>
			<Property name="ЗаказДата">
				<Value xsi:type="xs:string">Документ.ЗаказДата</Value>
			</Property>
			<Property name="ЗаказНомер">
				<Value xsi:type="xs:string">Документ.ЗаказНомер</Value>
			</Property>
			<Property name="Идентификатор">
				<Value xsi:type="xs:string">Документ.Идентификатор</Value>
			</Property>
			<Property name="ИдентификаторИспр">
				<Value xsi:type="xs:string">Документ.ИдентификаторИспр</Value>
			</Property>
			<Property name="Контрагент">
				<Value xsi:type="xs:string">Документ.Контрагент</Value>
			</Property>
			<Property name="Номер">
				<Value xsi:type="xs:string"/>
			</Property>
			<Property name="Организация">
				<Value xsi:type="xs:string">Документ.Организация</Value>
			</Property>
			<Property name="Ссылка">
				<Value xsi:type="xs:string">Документ.Ссылка</Value>
			</Property>
			<Property name="Статус">
				<Value xsi:type="xs:string">Документ.Статус</Value>
			</Property>
			<Property name="ФайлИмя">
				<Value xsi:type="xs:string">Документ.ФайлИмя</Value>
			</Property>
			<Property name="ЭлектронныйДокумент">
				<Value xsi:nil="true"/>
			</Property>
			<Property name="ИдентификаторЦепочки">
				<Value xsi:type="xs:string">Документ.ИдентификаторЦепочки</Value>
			</Property>
			<Property name="ИдентификаторОснования">
				<Value xsi:type="xs:string">Документ.ИдентификаторОснования</Value>
			</Property>
			<Property name="ТекстАннулирования">
				<Value xsi:type="xs:string">Документ.ТекстПредАн</Value>
			</Property>
		</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">5</lastId>
			<item>
				<value xsi:type="xs:string">ВерсПрог</value>
				<presentation>Документ.ВерсПрог</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ВерсФорм</value>
				<presentation>Документ.ВерсФорм</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИдФайл</value>
				<presentation>Документ.ИдФайл</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">5</id>
			</item>
		</Value>
		<Value xsi:type="xs:string">//ВидДокументаПриемника = ПредопределенноеЗначение("Перечисление.ЭКОМ_ВидыДокументов.DP_PRANNUL_22_Исходящий");

ТекстАннулирования = "";
Если ТипЗнч(Источник) 	= Тип("Структура") Тогда
    ТекстАннулирования 	= Источник.ТекстАн;
	Источник 			= Источник.МассивДок;
КонецЕсли;

Запрос = Новый Запрос;
Запрос.Текст = 
"ВЫБРАТЬ РАЗЛИЧНЫЕ
|	DR_Настройки.Ссылка КАК Ссылка,
|	ВТ_ФорматУПД.Значение КАК ФорматУПД,
|	ВТ_АннулированиеБезЗавершенияЦепочки.Значение КАК АннулированиеБезЗавершенияЦепочки
|ПОМЕСТИТЬ ВТ_ИнфоПоля
|ИЗ
|	Справочник.DR_Настройки КАК DR_Настройки
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК ВТ_ФорматУПД
|		ПО (DR_Настройки.Ссылка = ВТ_ФорматУПД.Ссылка)
|			И (ВТ_ФорматУПД.Реквизит = ""ФорматУПД"")
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК ВТ_АннулированиеБезЗавершенияЦепочки
|		ПО (DR_Настройки.Ссылка = ВТ_АннулированиеБезЗавершенияЦепочки.Ссылка)
|			И (ВТ_АннулированиеБезЗавершенияЦепочки.Реквизит = ""АннулированиеБезЗавершенияЦепочки"")
|ГДЕ
|	DR_Настройки.ВидНастройки = ""ИнфоПоля""
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ РАЗЛИЧНЫЕ
|	DR_МЧД.Ссылка КАК Ссылка,
|	DR_МЧД.Пользователь КАК Пользователь,
|	DR_Организация.Значение КАК Организация,
|	DR_МЧДДействительнаПо.Значение КАК МЧДДействительнаПо,
|	DR_МЧДДействительнаС.Значение КАК МЧДДействительнаС,
|	DR_Сертификат.Значение КАК Сертификат,
|	DR_СтрокаМЧД.Значение КАК СтрокаМЧД,
|	DR_ДолжностьПодписанта.Значение КАК ДолжностьПодписанта,
|	DR_ФамилияПодписанта.Значение КАК ФамилияПодписанта,
|	DR_ИмяПодписанта.Значение КАК ИмяПодписанта,
|	DR_ОтчествоПодписанта.Значение КАК ОтчествоПодписанта
|ПОМЕСТИТЬ ВТ_DR_МЧД
|ИЗ
|	Справочник.DR_Настройки КАК DR_МЧД
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_Организация
|		ПО DR_МЧД.Ссылка = DR_Организация.Ссылка
|			И (DR_Организация.Реквизит = ""Организация"")
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ДляРегламентныхЗаданий
|		ПО DR_МЧД.Ссылка = DR_ДляРегламентныхЗаданий.Ссылка
|			И (DR_ДляРегламентныхЗаданий.Реквизит = ""ДляРегламентныхЗаданий"")
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_МЧДДействительнаПо
|		ПО DR_МЧД.Ссылка = DR_МЧДДействительнаПо.Ссылка
|			И (DR_МЧДДействительнаПо.Реквизит = ""МЧДДействительнаПо"")
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_МЧДДействительнаС
|		ПО DR_МЧД.Ссылка = DR_МЧДДействительнаС.Ссылка
|			И (DR_МЧДДействительнаС.Реквизит = ""МЧДДействительнаС"")
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_Сертификат
|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки КАК DR_СпрСертификат
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ДолжностьПодписанта
|				ПО DR_СпрСертификат.Ссылка = DR_ДолжностьПодписанта.Ссылка
|					И (DR_ДолжностьПодписанта.Реквизит = ""ДолжностьПодписанта"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ФамилияПодписанта
|				ПО DR_СпрСертификат.Ссылка = DR_ФамилияПодписанта.Ссылка
|					И (DR_ФамилияПодписанта.Реквизит = ""ФамилияПодписанта"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ИмяПодписанта
|				ПО DR_СпрСертификат.Ссылка = DR_ИмяПодписанта.Ссылка
|					И (DR_ИмяПодписанта.Реквизит = ""ИмяПодписанта"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ОтчествоПодписанта
|				ПО DR_СпрСертификат.Ссылка = DR_ОтчествоПодписанта.Ссылка
|					И (DR_ОтчествоПодписанта.Реквизит = ""ОтчествоПодписанта"")
|			ПО DR_Сертификат.Значение = DR_СпрСертификат.Ссылка
|		ПО DR_МЧД.Ссылка = DR_Сертификат.Ссылка
|			И (DR_Сертификат.Реквизит = ""Сертификат"")
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_СтрокаМЧД
|		ПО DR_МЧД.Ссылка = DR_СтрокаМЧД.Ссылка
|			И (DR_СтрокаМЧД.Реквизит = ""СтрокаМЧД"")
|ГДЕ
|	DR_МЧД.ВидНастройки = ""МЧД""
|	И ВЫБОР
|			КОГДА &amp;ЭтоРегламентноеЗадание = ИСТИНА
|				ТОГДА DR_ДляРегламентныхЗаданий.Значение = ИСТИНА
|			ИНАЧЕ DR_МЧД.Пользователь = &amp;Пользователь
|		КОНЕЦ
|	И DR_МЧДДействительнаПо.Значение &gt; &amp;ТекущаяДата
|	И DR_МЧДДействительнаС.Значение &lt; &amp;ТекущаяДата
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|	DR_СобытияЮЗД.Документ КАК Ссылка,
|	ЗНАЧЕНИЕ(Перечисление.ЭКОМ_ВидыДокументов.DP_PRANNUL_22_Исходящий) КАК ВидДокумента,
|	DR_ЦепочкиДокументов.ДатаЗаказа КАК ЗаказДата,
|	DR_ЦепочкиДокументов.НомерЗаказа КАК ЗаказНомер,
|	DR_СобытияЮЗД.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
|	DR_СобытияЮЗД.ИдентификаторОснования КАК ИдентификаторОснование,
|	DR_ЦепочкиДокументов.Контрагент КАК Контрагент,
|	DR_ЦепочкиДокументов.Организация КАК Организация,
|	ЗНАЧЕНИЕ(Перечисление.ЭКОМ_Статусы.Отправлен) КАК Статус,
|	ЭКОМ_GLN_Контрагент.Ид_ОЭД КАК ИдКонтрагента,
|	ЭКОМ_GLN_Организации.Ид_ОЭД КАК ИдОрганизации,
|	DR_ЦепочкиДокументов.Контрагент.ИНН КАК КонтрагентИНН,
|	DR_ЦепочкиДокументов.Контрагент.КПП КАК КонтрагентКПП,
|	DR_ЦепочкиДокументов.Контрагент.Наименование КАК КонтрагентНаименование,
|	DR_ЦепочкиДокументов.Организация.ИНН КАК ОрганизацияИНН,
|	DR_ЦепочкиДокументов.Организация.КПП КАК ОрганизацияКПП,
|	DR_ЦепочкиДокументов.Организация.Наименование КАК ОрганизацияНаименование,
|	ВЫБОР
|		КОГДА ЭКОМ_GLN_Контрагент.Контрагент_ОтправитьМЧД = ИСТИНА
|			ТОГДА DR_МЧД.Сертификат
|		ИНАЧЕ ЭКОМ_GLN_Организации.Сертификат
|	КОНЕЦ КАК Сертификат,
|	ВЫБОР
|		КОГДА ЭКОМ_GLN_Контрагент.Контрагент_ОтправитьМЧД = ИСТИНА
|			ТОГДА DR_МЧД.ДолжностьПодписанта
|		ИНАЧЕ DR_ДолжностьПодписанта.Значение
|	КОНЕЦ КАК СертификатДолжностьПодписанта,
|	ВЫБОР
|		КОГДА ЭКОМ_GLN_Контрагент.Контрагент_ОтправитьМЧД = ИСТИНА
|			ТОГДА DR_МЧД.ФамилияПодписанта
|		ИНАЧЕ DR_ФамилияПодписанта.Значение
|	КОНЕЦ КАК СертификатФамилияПодписанта,
|	ВЫБОР
|		КОГДА ЭКОМ_GLN_Контрагент.Контрагент_ОтправитьМЧД = ИСТИНА
|			ТОГДА DR_МЧД.ИмяПодписанта
|		ИНАЧЕ DR_ИмяПодписанта.Значение
|	КОНЕЦ КАК СертификатИмяПодписанта,
|	ВЫБОР
|		КОГДА ЭКОМ_GLN_Контрагент.Контрагент_ОтправитьМЧД = ИСТИНА
|			ТОГДА DR_МЧД.ОтчествоПодписанта
|		ИНАЧЕ DR_ОтчествоПодписанта.Значение
|	КОНЕЦ КАК СертификатОтчествоПодписанта,
|	DR_СобытияЮЗД.Идентификатор КАК ИмяПоступившегоФайла,
|	DR_СобытияЮЗД.ДополнительнаяИнформация КАК ДополнительнаяИнформация,
|	Контр_Идентификатор.Значение КАК ИдОператораКонтрагента,
|	Орг_Идентификатор.Значение КАК ИдОператораОрганизации,
|	DR_ИнфоПоля.АннулированиеБезЗавершенияЦепочки КАК АннулированиеБезЗавершенияЦепочки,
|	ВЫБОР
|		КОГДА Титул_События.Идентификатор ЕСТЬ NULL
|			ТОГДА ЛОЖЬ
|		ИНАЧЕ ИСТИНА
|	КОНЕЦ КАК ДокуменоборотЗавершен,
|	DR_СобытияЮЗД.Идентификатор КАК ИдентификаторЮЗД,
|	ЭКОМ_GLN_Контрагент.Контрагент_ОтправитьМЧД КАК ОтправитьМЧД,
|	DR_МЧД.СтрокаМЧД КАК СтрокаМЧД
|ИЗ
|	РегистрСведений.DR_События КАК DR_СобытияЮЗД
|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_ЦепочкиДокументов КАК DR_ЦепочкиДокументов
|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_GLN КАК ЭКОМ_GLN_Организации
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК Орг_Идентификатор
|				ПО ЭКОМ_GLN_Организации.Партнер = Орг_Идентификатор.Ссылка
|					И (Орг_Идентификатор.Реквизит = ""Идентификатор"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ДолжностьПодписанта
|				ПО ЭКОМ_GLN_Организации.Сертификат = DR_ДолжностьПодписанта.Ссылка
|					И (DR_ДолжностьПодписанта.Реквизит = ""ДолжностьПодписанта"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ФамилияПодписанта
|				ПО ЭКОМ_GLN_Организации.Сертификат = DR_ФамилияПодписанта.Ссылка
|					И (DR_ФамилияПодписанта.Реквизит = ""ФамилияПодписанта"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ИмяПодписанта
|				ПО ЭКОМ_GLN_Организации.Сертификат = DR_ИмяПодписанта.Ссылка
|					И (DR_ИмяПодписанта.Реквизит = ""ИмяПодписанта"")
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_ОтчествоПодписанта
|				ПО ЭКОМ_GLN_Организации.Сертификат = DR_ОтчествоПодписанта.Ссылка
|					И (DR_ОтчествоПодписанта.Реквизит = ""ОтчествоПодписанта"")
|			ПО DR_ЦепочкиДокументов.Организация = ЭКОМ_GLN_Организации.Объект
|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЭКОМ_GLN КАК ЭКОМ_GLN_Контрагент
|				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК Контр_Идентификатор
|				ПО ЭКОМ_GLN_Контрагент.Партнер = Контр_Идентификатор.Ссылка
|					И (Контр_Идентификатор.Реквизит = ""Идентификатор"")
|				ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ИнфоПоля КАК DR_ИнфоПоля
|				ПО ЭКОМ_GLN_Контрагент.Контрагент_ФорматЭСФ = DR_ИнфоПоля.ФорматУПД
|					И (НЕ DR_ИнфоПоля.Ссылка.ПометкаУдаления)
|			ПО DR_ЦепочкиДокументов.Контрагент = ЭКОМ_GLN_Контрагент.Объект
|			ЛЕВОЕ СОЕДИНЕНИЕ ВТ_DR_МЧД КАК DR_МЧД
|			ПО DR_ЦепочкиДокументов.Организация = DR_МЧД.Организация
|		ПО DR_СобытияЮЗД.ИдентификаторЦепочки = DR_ЦепочкиДокументов.ИдентификаторЦепочки
|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК Титул_События
|		ПО DR_СобытияЮЗД.ИдентификаторЦепочки = Титул_События.ИдентификаторЦепочки
|			И DR_СобытияЮЗД.Документ = Титул_События.Документ
|			И (Титул_События.ВидДокумента В (&amp;ВидыДокументовТитулИсходящий))
|ГДЕ
|	DR_СобытияЮЗД.Документ В(&amp;Документ)
|	И DR_СобытияЮЗД.ВидДокумента В(&amp;ВидыДокументовЮЗД)";


ВидыДокументовЮЗД = Новый Массив;

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_SCHFDOPPR_01);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_SCHFDOPPR_01_Испр);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPR_01_Входящий);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPR_01_Испр_Входящий);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_KORSCHFDOPPR_01);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_KORSCHFDOPPR_01_Испр);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPR_01_Входящий);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPR_01_Испр_Входящий);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Входящий);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRMARK_01_Испр_Входящий);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPRMARK_01_Входящий);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPRMARK_01_Испр_Входящий);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Входящий);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPRPROS_01_Испр_Входящий);

ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPRPROS_01_Входящий);
ВидыДокументовЮЗД.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPRPROS_01_Испр_Входящий);

ВидыДокументовТитулИсходящий = Новый Массив;
ВидыДокументовТитулИсходящий.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPOKMARK_11_Исходящий);
ВидыДокументовТитулИсходящий.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPOKPROS_11_Исходящий);
ВидыДокументовТитулИсходящий.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NSCHFDOPPOK_11_Исходящий);
ВидыДокументовТитулИсходящий.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPOK_11_Исходящий);
ВидыДокументовТитулИсходящий.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPOKMARK_11_Исходящий);
ВидыДокументовТитулИсходящий.Добавить(Перечисления.ЭКОМ_ВидыДокументов.ON_NKORSCHFDOPPOKPROS_11_Исходящий); 


Запрос.УстановитьПараметр("Документ"         , Источник);
Запрос.УстановитьПараметр("ВидыДокументовЮЗД", ВидыДокументовЮЗД);
Запрос.УстановитьПараметр("ВидыДокументовТитулИсходящий", ВидыДокументовТитулИсходящий);
Запрос.УстановитьПараметр("Пользователь", НайтиТекущегоПользователя());
Запрос.УстановитьПараметр("ЭтоРегламентноеЗадание", ЭтоРегламентноеЗадание);
Запрос.УстановитьПараметр("ТекущаяДата", ТекущаяДата());
РезультатЗапроса = Запрос.Выполнить();
ВыборкаДокумента = РезультатЗапроса.Выбрать();

Результат = Новый ТаблицаЗначений;
МассивКолонок = Новый Массив;
 
//МЧД
МассивКолонок.Добавить("ОтправитьМЧД");
МассивКолонок.Добавить("Сертификат");
МассивКолонок.Добавить("СтрокаМЧД");

//Сведения для регистра ЭКОМ события для документа
МассивКолонок.Добавить("ВидДокумента");
МассивКолонок.Добавить("ЗаказДата");
МассивКолонок.Добавить("ЗаказНомер");
МассивКолонок.Добавить("Идентификатор");
МассивКолонок.Добавить("ИдентификаторИспр");
МассивКолонок.Добавить("Контрагент");
МассивКолонок.Добавить("Организация");
МассивКолонок.Добавить("Ссылка");
МассивКолонок.Добавить("Статус");
МассивКолонок.Добавить("ФайлИмя");
МассивКолонок.Добавить("ИдентификаторЦепочки");
МассивКолонок.Добавить("ИдентификаторОснования");

//Файл
МассивКолонок.Добавить("ИдФайл");
МассивКолонок.Добавить("ВерсПрог");
МассивКолонок.Добавить("ВерсФорм");
МассивКолонок.Добавить("GUIDФайла");

//УчастЭДО
МассивКолонок.Добавить("УчастЭДО_ИдУчастЭДО");
МассивКолонок.Добавить("УчастЭДО_НаимОрг");
МассивКолонок.Добавить("УчастЭДО_ИННЮЛ");
МассивКолонок.Добавить("УчастЭДО_КПП");

//СведАнФайл
МассивКолонок.Добавить("ИмяАнФайла");
МассивКолонок.Добавить("ЭЦПАнФайл");

//ТекстПредАн
МассивКолонок.Добавить("ТекстПредАн");

//НапрПредАн
МассивКолонок.Добавить("ТипПолучателя");
МассивКолонок.Добавить("НапрПредАн_ИдУчастЭДО");
МассивКолонок.Добавить("НапрПредАн_НаимОрг");
МассивКолонок.Добавить("НапрПредАн_ИННЮЛ");
МассивКолонок.Добавить("НапрПредАн_КПП");
МассивКолонок.Добавить("НапрПредАн_ФамилияФЛ");
МассивКолонок.Добавить("НапрПредАн_ИмяФЛ");
МассивКолонок.Добавить("НапрПредАн_ОтчествоФЛ");

//Подписант
МассивКолонок.Добавить("Подписант_Должность");
МассивКолонок.Добавить("Подписант_Фамилия");
МассивКолонок.Добавить("Подписант_Имя");
МассивКолонок.Добавить("Подписант_Отчество");

Для Каждого Колонка Из МассивКолонок Цикл
	Результат.Колонки.Добавить(Колонка);
КонецЦикла;

СтруктураМетаДанных  = ЮрФизЛицоОпределитьМетаданные();

Пока ВыборкаДокумента.Следующий() Цикл

	Если ВыборкаДокумента.АннулированиеБезЗавершенияЦепочки = Ложь
		И ВыборкаДокумента.ДокуменоборотЗавершен = Ложь Тогда

		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Документооборот не завершен! Аннулирование возможно только при завершеном документообороте.";
		Сообщение.Сообщить();

		Продолжить;
	КонецЕсли;

	НапрПредАн_ИдУчастЭДО = ВыборкаДокумента.ИдОператораКонтрагента + ВыборкаДокумента.ИдКонтрагента;
	УчастЭДО_ИдУчастЭДО   = ВыборкаДокумента.ИдОператораОрганизации + ВыборкаДокумента.ИдОрганизации;

	// Получаю из хранилища двоичные данные подписи и структуру файла
	ЭЦПАнФайл = Неопределено;
	СтруктураФайлаЮЗД = Неопределено;
	Если ЗначениеЗаполнено(ВыборкаДокумента.ДополнительнаяИнформация) Тогда
		
		ДополнительнаяИнформация = ВыборкаДокумента.ДополнительнаяИнформация.Получить();
		Если ТипЗнч(ДополнительнаяИнформация) = Тип("Структура") Тогда
		
			Если ДополнительнаяИнформация.Свойство("СтруктураФайла") Тогда 
				СтруктураФайлаЮЗД = ДополнительнаяИнформация.СтруктураФайла;
			КонецЕсли;
			
			Если ДополнительнаяИнформация.Свойство("ЭЦП") Тогда 
				ЭЦПАнФайл = ДополнительнаяИнформация.ЭЦП;
				Если ТипЗнч(ЭЦПАнФайл) = Тип("ХранилищеЗначения") Тогда 
				   ЭЦПАнФайл = ЭЦПАнФайл.Получить();
				КонецЕсли;
			КонецЕсли;
			
		Иначе

			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Нет данных по ЭЦП для документа - " + ВыборкаДокумента.ИмяПоступившегоФайла  + " аннулирование отправлено не будет!";
		    Сообщение.Сообщить();

			Продолжить;
			
		КонецЕсли;
		
	КонецЕсли;

	Если НЕ ЗначениеЗаполнено(ЭЦПАнФайл) Тогда

		Сообщение = Новый СообщениеПользователю;
	    Сообщение.Текст = "ЭЦП не определен! на документ " + ВыборкаДокумента.ИмяПоступившегоФайла  + " аннулирование отправлено не будет!";
	    Сообщение.Сообщить();
	    
	    Продолжить;
	    
	КонецЕсли;
	
	Если ВыборкаДокумента.ОтправитьМЧД = Истина И НЕ ЗначениеЗаполнено(ВыборкаДокумента.СтрокаМЧД) Тогда 
		ТекстЛогаСобытий = "Проверьте наличие доверенности для пользователя по организации " + ВыборкаДокумента.ПредставлениеОрганизации;
		ДобавитьЗаписьВМассивЛога(МассивЛогаСобытий, ТекстЛогаСобытий, Перечисления.ЭКОМ_УровниЛогирования.Ошибка, ИмяСобытия);
		Продолжить;
	КонецЕсли;

	СтруктураДокумента = Результат.Добавить();
	
	СтруктураДокумента.Сертификат = ВыборкаДокумента.Сертификат;
    СтруктураДокумента.ОтправитьМЧД = ВыборкаДокумента.ОтправитьМЧД;
    Если СтруктураДокумента.ОтправитьМЧД = Истина Тогда 
    	СтруктураДокумента.СтрокаМЧД = ВыборкаДокумента.СтрокаМЧД; 
    КонецЕсли; 

	СтруктураДокумента.НапрПредАн_ИдУчастЭДО = НапрПредАн_ИдУчастЭДО;
	СтруктураДокумента.НапрПредАн_ИННЮЛ      = ВыборкаДокумента.КонтрагентИНН;

	ЭтоЮрЛицоКонтрагент  = ЮрФизЛицоОпределитьТипОбъекта(ВыборкаДокумента.Контрагент, СтруктураМетаДанных.ИмяРеквизитаКонтрагента, СтруктураМетаДанных.ПеречислениеЮрЛицо);
	Если ЭтоЮрЛицоКонтрагент Тогда

		//НапрПредАн
		СтруктураДокумента.ТипПолучателя = "ЮЛ";
		СтруктураДокумента.НапрПредАн_НаимОрг = ВыборкаДокумента.КонтрагентНаименование;
		СтруктураДокумента.НапрПредАн_КПП     = ВыборкаДокумента.КонтрагентКПП;

	Иначе

		//НапрПредАн
		СтруктураДокумента.ТипПолучателя = "ИП";
		СтруктураДокумента.НапрПредАн_ФамилияФЛ  = "Нет";
		СтруктураДокумента.НапрПредАн_ИмяФЛ      = "Нет";
		СтруктураДокумента.НапрПредАн_ОтчествоФЛ = "";

		Если НЕ СтруктураФайлаЮЗД = Неопределено Тогда

			Если СтруктураФайлаЮЗД.Свойство("Документ_Подписант_ФЛ_ФИО_Фамилия") Тогда
				СтруктураДокумента.НапрПредАн_ФамилияФЛ  = СтруктураФайлаЮЗД.Документ_Подписант_ФЛ_ФИО_Фамилия;
			ИначеЕсли СтруктураФайлаЮЗД.Свойство("Подписант_Фамилия") Тогда
				СтруктураДокумента.НапрПредАн_ФамилияФЛ  = СтруктураФайлаЮЗД.Подписант_Фамилия;
			КонецЕсли;

			Если СтруктураФайлаЮЗД.Свойство("Документ_Подписант_ФЛ_ФИО_Имя") Тогда
				СтруктураДокумента.НапрПредАн_ИмяФЛ = СтруктураФайлаЮЗД.Документ_Подписант_ФЛ_ФИО_Имя;
			ИначеЕсли СтруктураФайлаЮЗД.Свойство("Подписант_Имя") Тогда
	            СтруктураДокумента.НапрПредАн_ИмяФЛ = СтруктураФайлаЮЗД.Подписант_Имя;
			КонецЕсли;

			Если СтруктураФайлаЮЗД.Свойство("Документ_Подписант_ФЛ_ФИО_Отчество") Тогда
				СтруктураДокумента.НапрПредАн_ОтчествоФЛ = СтруктураФайлаЮЗД.Документ_Подписант_ФЛ_ФИО_Отчество;
			ИначеЕсли СтруктураФайлаЮЗД.Свойство("Подписант_Отчество") Тогда
			    СтруктураДокумента.НапрПредАн_ОтчествоФЛ = СтруктураФайлаЮЗД.Подписант_Отчество;
			КонецЕсли;

		КонецЕсли;

		Если СтруктураДокумента.НапрПредАн_ФамилияФЛ = "Нет" Тогда
			НаименованиеФЛ = ВыборкаДокумента.КонтрагентНаименование;
			Если Найти(ВРег(НаименованиеФЛ), "ИП ") = 1 Тогда
				НаименованиеФЛ = Прав(НаименованиеФЛ, СтрДлина(НаименованиеФЛ) - 3);
			КонецЕсли;

			МассивИмяФЛ = Эком_РазложитьСтрокуВМассивПодстрок(НаименованиеФЛ, " ");

			Если МассивИмяФЛ.Количество() 		&gt;= 3 Тогда
				СтруктураДокумента.НапрПредАн_ФамилияФЛ 	= МассивИмяФЛ.Получить(0);
				СтруктураДокумента.НапрПредАн_ИмяФЛ 		= МассивИмяФЛ.Получить(1);
				СтруктураДокумента.НапрПредАн_ОтчествоФЛ 	= МассивИмяФЛ.Получить(2);
			ИначеЕсли МассивИмяФЛ.Количество() 	= 2 Тогда
				СтруктураДокумента.НапрПредАн_ФамилияФЛ 	= МассивИмяФЛ.Получить(0);
				СтруктураДокумента.НапрПредАн_ИмяФЛ 		= МассивИмяФЛ.Получить(1);
			ИначеЕсли МассивИмяФЛ.Количество() 	= 1 Тогда
				СтруктураДокумента.НапрПредАн_ФамилияФЛ 	= МассивИмяФЛ.Получить(0);
			КонецЕсли;
		КонецЕсли;

	КонецЕсли;

	Идентификатор = Новый УникальныйИдентификатор;
	ИдентификаторДляФайла = "DP_PRANNUL_"
	+ НапрПредАн_ИдУчастЭДО + "_"
	+ УчастЭДО_ИдУчастЭДО + "_"
	+ Формат(ТекущаяДата(), "ДФ=yyyyMMdd") + "_"
	+ Строка(Идентификатор);

	//Сведения для регистра ЭКОМ события для документа
	СтруктураДокумента.ВидДокумента        = ВыборкаДокумента.ВидДокумента;
	СтруктураДокумента.ЗаказДата           = ВыборкаДокумента.ЗаказДата;
	СтруктураДокумента.ЗаказНомер          = ВыборкаДокумента.ЗаказНомер;
	СтруктураДокумента.Идентификатор       = ИдентификаторДляФайла;
	СтруктураДокумента.ИдентификаторИспр   = ВыборкаДокумента.ИдентификаторОснование;
	СтруктураДокумента.ИдентификаторЦепочки= ВыборкаДокумента.ИдентификаторЦепочки;
	СтруктураДокумента.ИдентификаторОснования= ВыборкаДокумента.ИдентификаторЮЗД;
	СтруктураДокумента.Контрагент          = ВыборкаДокумента.Контрагент;
	СтруктураДокумента.Организация         = ВыборкаДокумента.Организация;
	СтруктураДокумента.Ссылка              = ВыборкаДокумента.Ссылка;
	СтруктураДокумента.Статус              = ВыборкаДокумента.Статус;
	СтруктураДокумента.ФайлИмя             = ИдентификаторДляФайла + ".xml";

	//Файл
	СтруктураДокумента.ИдФайл   = ИдентификаторДляФайла;
	СтруктураДокумента.ВерсПрог = "Exite 1C";
	СтруктураДокумента.ВерсФорм = "1.02";
	СтруктураДокумента.GUIDФайла = Идентификатор;

	//УчастЭДО
	СтруктураДокумента.УчастЭДО_ИдУчастЭДО = УчастЭДО_ИдУчастЭДО;
	СтруктураДокумента.УчастЭДО_НаимОрг    = ВыборкаДокумента.ОрганизацияНаименование;
	СтруктураДокумента.УчастЭДО_ИННЮЛ      = ВыборкаДокумента.ОрганизацияИНН;
	СтруктураДокумента.УчастЭДО_КПП        = ВыборкаДокумента.ОрганизацияКПП;

	//СведАнФайл
	СтруктураДокумента.ИмяАнФайла = ВыборкаДокумента.ИмяПоступившегоФайла;
	Base64СтрокаЭЦПАнФайл = Base64Строка(ЭЦПАнФайл);
	Base64СтрокаЭЦПАнФайл = СтрЗаменить(Base64СтрокаЭЦПАнФайл, Символы.ПС, "");
	Base64СтрокаЭЦПАнФайл = СтрЗаменить(Base64СтрокаЭЦПАнФайл, Символы.ВК, "");
	СтруктураДокумента.ЭЦПАнФайл  = Base64СтрокаЭЦПАнФайл;

	//ТекстПредАн
	СтруктураДокумента.ТекстПредАн  = ТекстАннулирования;

	//Подписант
	СтруктураДокумента.Подписант_Должность = ВыборкаДокумента.СертификатДолжностьПодписанта;
	СтруктураДокумента.Подписант_Фамилия   = ВыборкаДокумента.СертификатФамилияПодписанта;
	СтруктураДокумента.Подписант_Имя       = ВыборкаДокумента.СертификатИмяПодписанта;
	СтруктураДокумента.Подписант_Отчество  = ВыборкаДокумента.СертификатОтчествоПодписанта;

КонецЦикла;

Возврат Результат;</Value>
		<Value xsi:type="ValueTable"/>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">38</lastId>
			<item>
				<value xsi:type="xs:string">ОтправитьМЧД</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Сертификат</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">СтрокаМЧД</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">ВидДокумента</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЗаказДата</value>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЗаказНомер</value>
				<id xsi:type="xs:decimal">5</id>
			</item>
			<item>
				<value xsi:type="xs:string">Идентификатор</value>
				<id xsi:type="xs:decimal">6</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИдентификаторИспр</value>
				<id xsi:type="xs:decimal">7</id>
			</item>
			<item>
				<value xsi:type="xs:string">Контрагент</value>
				<id xsi:type="xs:decimal">8</id>
			</item>
			<item>
				<value xsi:type="xs:string">Организация</value>
				<id xsi:type="xs:decimal">9</id>
			</item>
			<item>
				<value xsi:type="xs:string">Ссылка</value>
				<id xsi:type="xs:decimal">10</id>
			</item>
			<item>
				<value xsi:type="xs:string">Статус</value>
				<id xsi:type="xs:decimal">11</id>
			</item>
			<item>
				<value xsi:type="xs:string">ФайлИмя</value>
				<id xsi:type="xs:decimal">12</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИдентификаторЦепочки</value>
				<id xsi:type="xs:decimal">13</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИдентификаторОснования</value>
				<id xsi:type="xs:decimal">14</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИдФайл</value>
				<id xsi:type="xs:decimal">15</id>
			</item>
			<item>
				<value xsi:type="xs:string">ВерсПрог</value>
				<id xsi:type="xs:decimal">16</id>
			</item>
			<item>
				<value xsi:type="xs:string">ВерсФорм</value>
				<id xsi:type="xs:decimal">17</id>
			</item>
			<item>
				<value xsi:type="xs:string">GUIDФайла</value>
				<id xsi:type="xs:decimal">18</id>
			</item>
			<item>
				<value xsi:type="xs:string">УчастЭДО_ИдУчастЭДО</value>
				<id xsi:type="xs:decimal">19</id>
			</item>
			<item>
				<value xsi:type="xs:string">УчастЭДО_НаимОрг</value>
				<id xsi:type="xs:decimal">20</id>
			</item>
			<item>
				<value xsi:type="xs:string">УчастЭДО_ИННЮЛ</value>
				<id xsi:type="xs:decimal">21</id>
			</item>
			<item>
				<value xsi:type="xs:string">УчастЭДО_КПП</value>
				<id xsi:type="xs:decimal">22</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяАнФайла</value>
				<id xsi:type="xs:decimal">23</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭЦПАнФайл</value>
				<id xsi:type="xs:decimal">24</id>
			</item>
			<item>
				<value xsi:type="xs:string">ТекстПредАн</value>
				<id xsi:type="xs:decimal">25</id>
			</item>
			<item>
				<value xsi:type="xs:string">ТипПолучателя</value>
				<id xsi:type="xs:decimal">26</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_ИдУчастЭДО</value>
				<id xsi:type="xs:decimal">27</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_НаимОрг</value>
				<id xsi:type="xs:decimal">28</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_ИННЮЛ</value>
				<id xsi:type="xs:decimal">29</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_КПП</value>
				<id xsi:type="xs:decimal">30</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_ФамилияФЛ</value>
				<id xsi:type="xs:decimal">31</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_ИмяФЛ</value>
				<id xsi:type="xs:decimal">32</id>
			</item>
			<item>
				<value xsi:type="xs:string">НапрПредАн_ОтчествоФЛ</value>
				<id xsi:type="xs:decimal">33</id>
			</item>
			<item>
				<value xsi:type="xs:string">Подписант_Должность</value>
				<id xsi:type="xs:decimal">34</id>
			</item>
			<item>
				<value xsi:type="xs:string">Подписант_Фамилия</value>
				<id xsi:type="xs:decimal">35</id>
			</item>
			<item>
				<value xsi:type="xs:string">Подписант_Имя</value>
				<id xsi:type="xs:decimal">36</id>
			</item>
			<item>
				<value xsi:type="xs:string">Подписант_Отчество</value>
				<id xsi:type="xs:decimal">37</id>
			</item>
			<item>
				<value xsi:type="xs:string">НомерПоПорядку</value>
				<id xsi:type="xs:decimal">38</id>
			</item>
		</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">-1</lastId>
		</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">DP_PRANNUL (покупатель - аннулирование)</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">4</lastId>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">ЭТРН</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>DP_PRANNUL (покупатель - аннулирование)</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
		</Value>
		<Value xsi:type="xs:string"/>
	</row>
</ValueTree>