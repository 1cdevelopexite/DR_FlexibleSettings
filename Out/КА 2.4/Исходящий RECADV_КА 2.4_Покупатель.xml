<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Данные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ИмяКнопки</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Регламент</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Исходящий RECADV</Value>
		<Value xsi:type="xs:string">#Область ШАПКА_Заполнение

Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ
               |	ВЫРАЗИТЬ(DR_События.Документ КАК Документ.ПриобретениеТоваровУслуг) КАК Источник,
               |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_События.ИдентификаторОснования КАК ИдентификаторОснования
               |ПОМЕСТИТЬ втDR_События_Источник
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События
               |ГДЕ
               |	DR_События.Документ В(&amp;Документ)
               |	И DR_События.ВидДокумента = ""Накладная_Входящая""
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	втDR_События_Источник.Источник КАК Источник,
               |	втDR_События_Источник.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	ВЫРАЗИТЬ(DR_События_DESADV.Документ КАК Документ.DR_Документ) КАК DESADV
               |ПОМЕСТИТЬ втДанныеПоЦепочке
               |ИЗ
               |	втDR_События_Источник КАК втDR_События_Источник
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_События_DESADV
               |		ПО втDR_События_Источник.ИдентификаторЦепочки = DR_События_DESADV.ИдентификаторЦепочки
               |			И (DR_События_DESADV.ВидДокумента = ""DESADV_Входящий"")
               |			И втDR_События_Источник.ИдентификаторОснования = DR_События_DESADV.Идентификатор
               |			И (DR_События_DESADV.Статус = ""Обработан"")
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	втДанныеПоЦепочке.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	втДанныеПоЦепочке.Источник КАК Ссылка,
               |	втДанныеПоЦепочке.Источник.Номер КАК NUMBER,
               |	втДанныеПоЦепочке.Источник.Дата КАК ДатаИсточник,
               |	втДанныеПоЦепочке.Источник.Контрагент КАК Контрагент,
               |	втДанныеПоЦепочке.Источник.Организация КАК Организация,
			   |	втДанныеПоЦепочке.Источник.ЦенаВключаетНДС КАК ЦенаВключаетНДС,
               |	ДоговорКонтрагента.Номер КАК CAMPAIGNNUMBER,
               |	ДоговорКонтрагента.Дата КАК ДатаДоговорКонтрагента,
               |	втДанныеПоЦепочке.DESADV КАК DESADV,
               |	ВЫРАЗИТЬ(DR_BUYER.Значение КАК СТРОКА(13)) КАК SENDER,
               |	ВЫРАЗИТЬ(DR_SUPPLIER.Значение КАК СТРОКА(13)) КАК RECIPIENT,
               |	ВЫРАЗИТЬ(DR_BUYER.Значение КАК СТРОКА(13)) КАК BUYER,
               |	ВЫРАЗИТЬ(DR_SUPPLIER.Значение КАК СТРОКА(13)) КАК SUPPLIER,
               |	ВЫРАЗИТЬ(DR_DELIVERYPLACE.Значение КАК СТРОКА(13)) КАК DELIVERYPLACE,
               |	ВЫРАЗИТЬ(DR_ORDERNUMBER.Значение КАК СТРОКА(35)) КАК ORDERNUMBER,
               |	ВЫРАЗИТЬ(DR_ORDERDATE.Значение КАК СТРОКА(10)) КАК ORDERDATE,
               |	ВЫРАЗИТЬ(DR_NUMBER.Значение КАК СТРОКА(35)) КАК DESADVNUMBER,
               |	ВЫРАЗИТЬ(DR_DATE.Значение КАК СТРОКА(10)) КАК DESADVDATE,
			   |	DR_POSITION.ХранилищеЗначения КАК POSITION,
			   |	""RUB"" КАК CURRENCY,
               |	""Отправлен"" КАК Статус,
               |	""RECADV"" КАК ВидДокумента,
               |	""1"" КАК HIERARCHICALID,
               |	""O"" КАК DOCTYPE,
			   |	""9"" КАК ACTION,
			   |	ВЫРАЗИТЬ("""" КАК СТРОКА(10)) КАК DATE,
               |	ВЫРАЗИТЬ("""" КАК СТРОКА(10)) КАК CAMPAIGNDATE,
               |	ВЫРАЗИТЬ("""" КАК СТРОКА(35)) КАК DELIVERYNOTENUMBER,
               |	ВЫРАЗИТЬ("""" КАК СТРОКА(10)) КАК DELIVERYNOTEDATE,
			   |	ВЫРАЗИТЬ("""" КАК СТРОКА(10)) КАК RECEPTIONDATE,               
			   |	ВЫРАЗИТЬ("""" КАК СТРОКА(300)) КАК EDIMESSAGE,
               |	ВЫРАЗИТЬ("""" КАК СТРОКА(20)) КАК EDIINTERCHANGEID,
			   |	ВЫРАЗИТЬ("""" КАК СТРОКА(300)) КАК ФайлИмя,
               |	ВЫРАЗИТЬ("""" КАК СТРОКА(300)) КАК Идентификатор
               |ИЗ
               |	втДанныеПоЦепочке КАК втДанныеПоЦепочке
               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорКонтрагента
               |		ПО втДанныеПоЦепочке.Источник.Договор = ДоговорКонтрагента.Ссылка
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_POSITION
               |		ПО втДанныеПоЦепочке.DESADV = DR_POSITION.Ссылка
               |			И (DR_POSITION.Реквизит = ""POSITION"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_NUMBER
               |		ПО втДанныеПоЦепочке.DESADV = DR_NUMBER.Ссылка
               |			И (DR_NUMBER.Реквизит = ""NUMBER"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_ORDERNUMBER
               |		ПО втДанныеПоЦепочке.DESADV = DR_ORDERNUMBER.Ссылка
               |			И (DR_ORDERNUMBER.Реквизит = ""ORDERNUMBER"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_ORDERDATE
               |		ПО втДанныеПоЦепочке.DESADV = DR_ORDERDATE.Ссылка
               |			И (DR_ORDERDATE.Реквизит = ""ORDERDATE"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_BUYER
               |		ПО втДанныеПоЦепочке.DESADV = DR_BUYER.Ссылка
               |			И (DR_BUYER.Реквизит = ""BUYER"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_SUPPLIER
               |		ПО втДанныеПоЦепочке.DESADV = DR_SUPPLIER.Ссылка
               |			И (DR_SUPPLIER.Реквизит = ""SUPPLIER"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_DELIVERYPLACE
               |		ПО втДанныеПоЦепочке.DESADV = DR_DELIVERYPLACE.Ссылка
               |			И (DR_DELIVERYPLACE.Реквизит = ""DELIVERYPLACE"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DR_DATE
               |		ПО втДанныеПоЦепочке.DESADV = DR_DATE.Ссылка
               |			И (DR_DATE.Реквизит = ""DATE"")";

Запрос.УстановитьПараметр("Документ", Источник);

РезультатЗапроса = Запрос.Выполнить(); 
Результат = РезультатЗапроса.Выгрузить();

ДатуВСтроку = Новый Соответствие;
ДатуВСтроку.Вставить("DATE"				, "Строка.ДатаИсточник");
ДатуВСтроку.Вставить("CAMPAIGNDATE"		, "Строка.ДатаДоговорКонтрагента");
ДатуВСтроку.Вставить("RECEPTIONDATE"	, "Строка.ДатаИсточник");

EDIINTERCHANGEID = 0; 

СтрокиДляУдаления 	= Новый Массив;
ДокументРеализации  = Неопределено;

КвалификаторСтроки = Новый КвалификаторыСтроки(250,ДопустимаяДлина.Переменная);

ДанныеDESADV = новый ТаблицаЗначений;
ДанныеDESADV.Колонки.Добавить("Поступление"				, Новый ОписаниеТипов("ДокументСсылка.ПриобретениеТоваровУслуг"));
ДанныеDESADV.Колонки.Добавить("ЦенаВключаетНДС"			, Новый ОписаниеТипов("Булево"));
ДанныеDESADV.Колонки.Добавить("Номенклатура"			, Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
ДанныеDESADV.Колонки.Добавить("DELIVEREDUNIT"			, Новый ОписаниеТипов("Строка", КвалификаторСтроки));
ДанныеDESADV.Колонки.Добавить("КоличествоЗаказанное"	, Новый ОписаниеТипов("Число"));
ДанныеDESADV.Колонки.Добавить("КоличествоПоставленное"	, Новый ОписаниеТипов("Число"));
ДанныеDESADV.Колонки.Добавить("КоличествоВУпаковке"		, Новый ОписаниеТипов("Число"));
ДанныеDESADV.Колонки.Добавить("DESCRIPTION"				, Новый ОписаниеТипов("Строка", КвалификаторСтроки));
ДанныеDESADV.Колонки.Добавить("PRODUCT"					, Новый ОписаниеТипов("Строка", КвалификаторСтроки));
ДанныеDESADV.Колонки.Добавить("PRODUCTIDBUYER"			, Новый ОписаниеТипов("Строка", КвалификаторСтроки));
ДанныеDESADV.Колонки.Добавить("PRODUCTIDSUPPLIER"		, Новый ОписаниеТипов("Строка", КвалификаторСтроки)); 

Для Каждого Строка Из Результат Цикл

    POSITION = Строка.POSITION.Получить();
	
	Для Каждого СтрокаНоменклатуры Из POSITION Цикл
		
		НоваяСтрокаDESADV = ДанныеDESADV.Добавить();
		
		ЗаполнитьЗначенияСвойств(НоваяСтрокаDESADV, СтрокаНоменклатуры); 
				
		НоваяСтрокаDESADV.Поступление  = Строка.Ссылка;		
		НоваяСтрокаDESADV.КоличествоЗаказанное = СтрокаНоменклатуры.ORDEREDQUANTITY;
		НоваяСтрокаDESADV.КоличествоПоставленное = СтрокаНоменклатуры.DELIVEREDQUANTITY;
		
		Если СтрокаНоменклатуры.Свойство("QUANTITYOFCUINTU") Тогда 
			НоваяСтрокаDESADV.КоличествоВУпаковке = СтрокаНоменклатуры.QUANTITYOFCUINTU;
		КонецЕсли;
		
	КонецЦикла;

    Если ДокументРеализации = Строка.Ссылка Тогда
        СтрокиДляУдаления.Добавить(Строка);
        Продолжить;
    КонецЕсли;
    
    ДокументРеализации = Строка.Ссылка;
	
	NUMBER = Эком_ПолучитьНомерНаПечать(ДокументРеализации, Истина, Ложь); //второй параметр убирает префикс, третий параметр убирает лидирующие нули.
	
	Строка.NUMBER = NUMBER;
	
	// Преобразование даты в строку и заполнение значения.
    Для Каждого ЗаписьДатуВСтроку Из ДатуВСтроку Цикл
        Строка[ЗаписьДатуВСтроку.Ключ] = Формат(Вычислить(ЗаписьДатуВСтроку.Значение), "ДФ=yyyy-MM-dd");
    КонецЦикла;
		
    EDIINTERCHANGEID = НовыйНомерТранзакции(EDIINTERCHANGEID);
    Строка.EDIINTERCHANGEID = Формат(EDIINTERCHANGEID, "ЧГ=0");
	
	// EDIMESSAGE.
    ГСЧ               = Новый ГенераторСлучайныхЧисел;
    СлучЧисло         = ГСЧ.СлучайноеЧисло(100, 999);
    Строка.EDIMESSAGE = Формат(ТекущаяДата(), "ДФ=ггггММддЧЧммсс000") + СлучЧисло + "-OUT-" + Строка.EDIINTERCHANGEID;
	
    Строка.ФайлИмя          = Строка.ВидДокумента + "_" + Строка.EDIMESSAGE + ".xml";
    Строка.Идентификатор    = Строка.ВидДокумента + "_" + Строка.EDIMESSAGE;
	
КонецЦикла;

Для Каждого Строка Из СтрокиДляУдаления Цикл
    Результат.Удалить(Строка);
КонецЦикла;

#КонецОбласти

#Область ТАБЛИЦА_Заполнение
ЗапросНоменклатур = Новый Запрос;
ЗапросНоменклатур.Текст = "ВЫБРАТЬ
                          |	ДанныеТЧНоменклатурDESADV.Поступление КАК Ссылка,
                          |	ДанныеТЧНоменклатурDESADV.Номенклатура КАК Номенклатура,
                          |	ДанныеТЧНоменклатурDESADV.ЦенаВключаетНДС КАК ЦенаВключаетНДС,
                          |	ДанныеТЧНоменклатурDESADV.DELIVEREDUNIT КАК DELIVEREDUNIT,
                          |	ДанныеТЧНоменклатурDESADV.КоличествоЗаказанное КАК КоличествоЗаказанное,
                          |	ДанныеТЧНоменклатурDESADV.КоличествоПоставленное КАК КоличествоПоставленное,
						  |	ДанныеТЧНоменклатурDESADV.КоличествоВУпаковке КАК КоличествоВУпаковке,
                          |	ДанныеТЧНоменклатурDESADV.DESCRIPTION КАК DESCRIPTION,
                          |	ДанныеТЧНоменклатурDESADV.PRODUCT КАК PRODUCT,
                          |	ДанныеТЧНоменклатурDESADV.PRODUCTIDBUYER КАК PRODUCTIDBUYER,
                          |	ДанныеТЧНоменклатурDESADV.PRODUCTIDSUPPLIER КАК PRODUCTIDSUPPLIER
                          |ПОМЕСТИТЬ ТаблицаDESADV
                          |ИЗ
                          |	&amp;ДанныеТЧНоменклатурDESADV КАК ДанныеТЧНоменклатурDESADV
                          |;
                          |
                          |////////////////////////////////////////////////////////////////////////////////
                          |ВЫБРАТЬ
                          |	ТаблицаDESADV.Ссылка КАК Ссылка,
                          |	ТаблицаТовары.НомерСтроки КАК НомерСтроки,
                          |	ТаблицаТовары.Номенклатура КАК Номенклатура,
                          |	ТаблицаТовары.Номенклатура.Код КАК КодНоменклатуры,
                          |	ТаблицаТовары.КоличествоУпаковок КАК Количество,
                          |	ВЫБОР
                          |		КОГДА ТаблицаDESADV.ЦенаВключаетНДС
                          |			ТОГДА ВЫРАЗИТЬ((ТаблицаТовары.Сумма - ТаблицаТовары.СуммаНДС) / ТаблицаТовары.КоличествоУпаковок КАК ЧИСЛО(15, 2))
                          |		ИНАЧЕ ТаблицаТовары.Цена
                          |	КОНЕЦ КАК ЦенаБезНДС,
                          |	ВЫБОР
                          |		КОГДА ТаблицаDESADV.ЦенаВключаетНДС
                          |			ТОГДА ТаблицаТовары.Цена
                          |		ИНАЧЕ ВЫРАЗИТЬ((ТаблицаТовары.Сумма + ТаблицаТовары.СуммаНДС) / ТаблицаТовары.КоличествоУпаковок КАК ЧИСЛО(15, 2))
                          |	КОНЕЦ КАК ЦенаСНДС,
                          |	ВЫБОР
                          |		КОГДА ТаблицаDESADV.ЦенаВключаетНДС
                          |			ТОГДА ТаблицаТовары.СуммаСНДС - ТаблицаТовары.СуммаНДС
                          |		ИНАЧЕ ТаблицаТовары.Сумма
                          |	КОНЕЦ КАК СтоимостьБезНДС,
                          |	ВЫБОР
                          |		КОГДА ТаблицаDESADV.ЦенаВключаетНДС
                          |			ТОГДА ТаблицаТовары.СуммаСНДС
                          |		ИНАЧЕ ТаблицаТовары.Сумма + ТаблицаТовары.СуммаНДС
                          |	КОНЕЦ КАК СтоимостьСНДС,
                          |	ТаблицаТовары.СуммаНДС КАК СуммаНДС,
                          |	ТаблицаТовары.СтавкаНДС КАК СтавкаНДС
                          |ПОМЕСТИТЬ ТаблицаТовары
                          |ИЗ
                          |	ТаблицаDESADV КАК ТаблицаDESADV
                          |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг.Товары КАК ТаблицаТовары
                          |		ПО ТаблицаDESADV.Ссылка = ТаблицаТовары.Ссылка
                          |			И ТаблицаDESADV.Номенклатура = ТаблицаТовары.Номенклатура
                          |ГДЕ
                          |	ТаблицаТовары.Количество &gt; 0
                          |
                          |ИНДЕКСИРОВАТЬ ПО
                          |	Ссылка,
                          |	Номенклатура
                          |;
                          |
                          |////////////////////////////////////////////////////////////////////////////////
                          |ВЫБРАТЬ
                          |	ТаблицаDESADV.Ссылка КАК Ссылка,
                          |	ТаблицаТовары.НомерСтроки КАК POSITIONNUMBER,
                          |	ТаблицаDESADV.Номенклатура КАК Номенклатура,
                          |	ТаблицаDESADV.DELIVEREDUNIT КАК ACCEPTEDUNIT,
                          |	ТаблицаDESADV.КоличествоЗаказанное КАК КоличествоЗаказанное,
                          |	ТаблицаDESADV.КоличествоПоставленное КАК КоличествоПоставленное,
						  |	ТаблицаDESADV.КоличествоВУпаковке КАК КоличествоВУпаковке,
                          |	ТаблицаDESADV.DESCRIPTION КАК DESCRIPTION,
                          |	ТаблицаDESADV.PRODUCT КАК PRODUCT,
                          |	ТаблицаDESADV.PRODUCTIDBUYER КАК PRODUCTIDBUYER,
                          |	ТаблицаDESADV.PRODUCTIDSUPPLIER КАК PRODUCTIDSUPPLIER,
                          |	ТаблицаТовары.Количество КАК КоличествоПринятое,
                          |	ТаблицаТовары.ЦенаБезНДС КАК ЦенаБезНДС,
                          |	ТаблицаТовары.ЦенаСНДС КАК ЦенаСНДС,
                          |	ТаблицаТовары.СтоимостьБезНДС КАК СтоимостьБезНДС,
                          |	ТаблицаТовары.СтоимостьСНДС КАК СтоимостьСНДС,
                          |	ТаблицаТовары.СуммаНДС КАК СуммаНДС,
                          |	ТаблицаТовары.СтавкаНДС КАК СтавкаНДС,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК ORDERQUANTITY,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК DELIVERQUANTITY,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК ACCEPTEDQUANTITY,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК PRICE,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК PRICEWITHVAT,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК AMOUNT,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК AMOUNTWITHVAT,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(20)) КАК VATAMOUNT,
                          |	ВЫРАЗИТЬ("""""""" КАК СТРОКА(2)) КАК VAT
                          |ИЗ
                          |	ТаблицаDESADV КАК ТаблицаDESADV
                          |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТаблицаТовары КАК ТаблицаТовары
                          |		ПО ТаблицаDESADV.Ссылка = ТаблицаТовары.Ссылка
                          |			И ТаблицаDESADV.Номенклатура = ТаблицаТовары.Номенклатура";

ЗапросНоменклатур.УстановитьПараметр("ДанныеТЧНоменклатурDESADV", ДанныеDESADV);

РезультатЗапросаНоменклатур = ЗапросНоменклатур.Выполнить(); 
РезультатНоменклатур = РезультатЗапросаНоменклатур.Выгрузить();

ЧислоВСтроку = Новый СписокЗначений;
ЧислоВСтроку.Добавить("ORDERQUANTITY"		, "СтрокаНоменклатуры.КоличествоЗаказанное"		, Истина);
ЧислоВСтроку.Добавить("DELIVERQUANTITY"		, "СтрокаНоменклатуры.КоличествоПоставленное"	, Истина);
ЧислоВСтроку.Добавить("ACCEPTEDQUANTITY"	, "СтрокаНоменклатуры.КоличествоПринятое"		, Истина);
ЧислоВСтроку.Добавить("QUANTITYOFCUINTU"	, "СтрокаНоменклатуры.КоличествоВУпаковке"		, Истина);
ЧислоВСтроку.Добавить("PRICE"				, "СтрокаНоменклатуры.ЦенаБезНДС");
ЧислоВСтроку.Добавить("PRICEWITHVAT"		, "СтрокаНоменклатуры.ЦенаСНДС");
ЧислоВСтроку.Добавить("AMOUNT"				, "СтрокаНоменклатуры.СтоимостьБезНДС");
ЧислоВСтроку.Добавить("AMOUNTWITHVAT"		, "СтрокаНоменклатуры.СтоимостьСНДС");
ЧислоВСтроку.Добавить("VATAMOUNT"			, "СтрокаНоменклатуры.СуммаНДС");

Для Каждого СтрокаНоменклатуры Из РезультатНоменклатур Цикл                               
	
	// Преобразование числа в строку и заполнение значения.
    Для Каждого ЗаписьЧислоВСтроку Из ЧислоВСтроку Цикл
        
        ЗначениеЧисла = Вычислить(ЗаписьЧислоВСтроку.Представление);
		
		Если ЗначениеЧисла = 0 Тогда
			Продолжить;
		КонецЕсли;
		
        ЗначениеСтрокой = Формат(ЗначениеЧисла, "ЧДЦ=3; ЧРД=.; ЧГ=0; ЧН=");
        
        Если НЕ ЗаписьЧислоВСтроку.Пометка Тогда
            ЗначениеСтрокой = Формат(ЗначениеЧисла, "ЧДЦ=2; ЧРД=.; ЧГ=0; ЧН=0.00");
        КонецЕсли;
        
        СтрокаНоменклатуры[ЗаписьЧислоВСтроку.Значение] = ЗначениеСтрокой;
    
	КонецЦикла;
	
	Если СтрокаНоменклатуры.СтавкаНДС &lt;&gt; Перечисления.СтавкиНДС.БезНДС Тогда
    	СтрокаНоменклатуры.VAT = Сред(Строка(СтрокаНоменклатуры.СтавкаНДС),1,2);
	КонецЕсли;
	
КонецЦикла;

#КонецОбласти

#Область СОЗДАНИЕ_XML	

//Проверка наличия обязательных полей
ОбязательныеКолонки = Новый СписокЗначений;

//DESADV
ОбязательныеКолонки.Добавить("NUMBER"			, "NUMBER"			, Истина);
ОбязательныеКолонки.Добавить("DATE"				, "DATE" 			, Истина);
ОбязательныеКолонки.Добавить("ORDERNUMBER"		, "ORDERNUMBER" 	, Истина);
ОбязательныеКолонки.Добавить("ORDERDATE"		, "ORDERDATE" 		, Истина);
ОбязательныеКолонки.Добавить("RECEPTIONDATE"	, "RECEPTIONDATE" 	, Истина);

//HEAD
ОбязательныеКолонки.Добавить("SUPPLIER"			, "SUPPLIER"		, Истина);
ОбязательныеКолонки.Добавить("BUYER"			, "BUYER"			, Истина);
ОбязательныеКолонки.Добавить("RECIPIENT"		, "RECIPIENT"		, Истина);
ОбязательныеКолонки.Добавить("DELIVERYPLACE"	, "DELIVERYPLACE"	, Истина);
ОбязательныеКолонки.Добавить("SENDER"		 	, "SENDER"			, Истина);

ОбязательныеКолонки.Добавить("HIERARCHICALID"	, "HIERARCHICALID"	, Истина);

//POSITION
ОбязательныеКолонки.Добавить("POSITIONNUMBER"	, "POSITIONNUMBER"		, Истина);
ОбязательныеКолонки.Добавить("PRODUCT"			, "PRODUCT"				, Истина);
ОбязательныеКолонки.Добавить("PRODUCTIDBUYER"	, "PRODUCTIDBUYER"		, Истина);
ОбязательныеКолонки.Добавить("ACCEPTEDQUANTITY"	, "ACCEPTEDQUANTITY"	, Истина);


МассивСтруктурИсходящих = Новый Массив;	

//Структура свойств шапки документа
СтруктураШапка = Новый Структура("NUMBER, DATE, ORDERNUMBER, ORDERDATE, RECEPTIONDATE, DESADVNUMBER, DESADVDATE, 
								| DELIVERYNOTENUMBER, DELIVERYNOTEDATE, TOTALAMOUNTWITHVAT, TOTALAMOUNT, TOTALVAT, 
								| CAMPAIGNNUMBER, CAMPAIGNDATE, ACTION, DOCTYPE, INFO, HEAD");

//Структура свойств элемента HEAD
СтруктураHEAD = Новый Структура("SUPPLIER, BUYER, DELIVERYPLACE, SENDER, RECIPIENT, EDIINTERCHANGEID, EDIMESSAGE, PACKINGSEQUENCE");

//Структура свойств элемента PACKINGSEQUENCE
СтруктураPACKINGSEQUENCE = Новый Структура("HIERARCHICALID, POSITION");

//Имена свойств элемента POSITION
СвойстваPOSITION = "POSITIONNUMBER, PRODUCT, PRODUCTIDBUYER, PRODUCTIDSUPPLIER, ORDERQUANTITY, DELIVERQUANTITY,
					| ACCEPTEDQUANTITY, ORDERUNIT, ACCEPTEDUNIT, PRICE, PRICEWITHVAT, TAXRATE, VAT, AMOUNT,
					| AMOUNTWITHVAT, VATAMOUNT, DESCRIPTION, QUANTITYOFCUINTU";


Для каждого СтрокаШапкиДокумента из Результат Цикл

		ТекстСообщенияПроверкиЗаполненияОбязательныхПолей = "";  
	    
	    //Заполнение структуры документа
		СтруктураДок = Новый Структура("RECADV");
	    
	    СтруктураДок.RECADV = СтруктураШапка;
	    СтруктураШапка.HEAD = СтруктураHEAD;
	    СтруктураHEAD.PACKINGSEQUENCE = СтруктураPACKINGSEQUENCE;
	    
		//Заполнение значений свойств шапки документа
		ЗаполнитьЗначенияСвойств(СтруктураШапка, СтрокаШапкиДокумента);
	
		//Заполнение значений свойств элемента HEAD
		ЗаполнитьЗначенияСвойств(СтруктураHEAD, СтрокаШапкиДокумента);
	
		МассивPOSITION = Новый Массив;
	    
	    ОтборСтрокНоменклатур = Новый Структура;
		ОтборСтрокНоменклатур.Вставить("Ссылка", СтрокаШапкиДокумента.Ссылка);
	
		СтрокиНоменклатурДокумента = РезультатНоменклатур.НайтиСтроки(ОтборСтрокНоменклатур);
		
		Для Каждого СтрокаНоменклатурыДокумента Из СтрокиНоменклатурДокумента Цикл
			
			//Создание структуры POSITION
			Структура = Новый Структура(СвойстваPOSITION);
			
			//Заполнение значений свойств элемента POSITION
			ЗаполнитьЗначенияСвойств(Структура, СтрокаНоменклатурыДокумента);
			
			МассивPOSITION.Добавить(Структура);
		КонецЦикла;
		
		//Заполнение значений свойств элемента HIERARCHICALID
		СтруктураPACKINGSEQUENCE.HIERARCHICALID = СтрокаШапкиДокумента.HIERARCHICALID;
		СтруктураPACKINGSEQUENCE.POSITION = МассивPOSITION;
	    
		//Создание XML строки
		XMLДокумент        	= Новый ЗаписьXML;		
		ПараметрыЗаписиXML 	= Новый ПараметрыЗаписиXML("UTF-8", "1.0", Истина, Ложь, Символы.Таб); 
		XMLДокумент.УстановитьСтроку("UTF-8");
		XMLДокумент.ЗаписатьОбъявлениеXML();
		
		Для каждого СтрокаЭлемента Из СтруктураДок Цикл
			ЗаписатьБлоки(XMLДокумент, СтрокаЭлемента, ОбязательныеКолонки, ТекстСообщенияПроверкиЗаполненияОбязательныхПолей);
		КонецЦикла;	

			СтрокаXML = XMLДокумент.Закрыть(); 
			
			
			Если ЗначениеЗаполнено(ТекстСообщенияПроверкиЗаполненияОбязательныхПолей) Тогда
			
				ТекстЛогаСобытий = ТекстСообщенияПроверкиЗаполненияОбязательныхПолей + Символы.ПС + "Документ был пропущен.";
			
				ДобавитьЗаписьВМассивЛога(МассивЛогаСобытий, ТекстЛогаСобытий, "Предупреждение", ИмяСобытия);
			
			Продолжить;	
		Иначе	
			
			СтруктураФайлаДанных = Новый Структура;
			СтруктураФайлаДанных.Вставить("ВидДокумента"			, "RECADV_Исходящий");
			СтруктураФайлаДанных.Вставить("Документ"				, СтрокаШапкиДокумента.Ссылка);
			СтруктураФайлаДанных.Вставить("ИдентификаторЦепочки"	, СтрокаШапкиДокумента.ИдентификаторЦепочки);
			СтруктураФайлаДанных.Вставить("ИмяФайлаXML"				, СтрокаШапкиДокумента.ФайлИмя);
			СтруктураФайлаДанных.Вставить("КодировкаФайла"			, "UTF-8");
			СтруктураФайлаДанных.Вставить("Организация"				, СтрокаШапкиДокумента.Организация);
			СтруктураФайлаДанных.Вставить("Отправлен"				, НЕОПРЕДЕЛЕНО);
			СтруктураФайлаДанных.Вставить("Сообщение"				, "");
			СтруктураФайлаДанных.Вставить("Статус"					, СтрокаШапкиДокумента.Статус);
			СтруктураФайлаДанных.Вставить("СтрокаXML"				, СтрокаXML);
			СтруктураФайлаДанных.Вставить("ТипФайла"				, СтрокаШапкиДокумента.ВидДокумента);
			
			МассивСтруктурИсходящих.Добавить(СтруктураФайлаДанных);
			
		КонецЕсли;
	
КонецЦикла;

#КонецОбласти

//Возврат Результат;				//раскомментировать для отображения значений таблицы "Результат" на вкладке "Тестирование"  
//Возврат РезультатНоменклатур;		//раскомментировать для отображения значений таблицы "РезультатНоменклатур" на вкладке "Тестирование"

Возврат МассивСтруктурИсходящих;</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">Исходящий RECADV</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">8</lastId>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<presentation>СписокНакладныеВходящиеПокупатель</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Синоним</value>
				<presentation>Исходящий RECADV</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>ИсходящийRECADV</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ПередаватьТекстПричины</value>
				<id xsi:type="xs:decimal">5</id>
			</item>
			<item>
				<value xsi:type="xs:string">ПриемникВидДокумента</value>
				<presentation>RECADV_Исходящий</presentation>
				<id xsi:type="xs:decimal">6</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИсточникВидДокумента</value>
				<presentation>Накладная_Входящая</presentation>
				<id xsi:type="xs:decimal">7</id>
			</item>
			<item>
				<value xsi:type="xs:string">НужнаПодпись</value>
				<presentation>Нет</presentation>
				<id xsi:type="xs:decimal">8</id>
			</item>
		</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">ИсходящийRECADV</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">1</lastId>
			<item>
				<value xsi:type="xs:string">ТекстЗапроса = "ВЫБРАТЬ
               |	ПриобретениеТоваровУслуг.Ссылка КАК Ссылка
               |ПОМЕСТИТЬ втПоступление
               |ИЗ
               |	Документ.ПриобретениеТоваровУслуг КАК ПриобретениеТоваровУслуг
               |ГДЕ
               |	ПриобретениеТоваровУслуг.Дата МЕЖДУ НАЧАЛОПЕРИОДА(&amp;ТекущаяДата, ДЕНЬ) И КОНЕЦПЕРИОДА(&amp;ТекущаяДата, ДЕНЬ)
               |	И ПриобретениеТоваровУслуг.Проведен
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	втПоступление.Ссылка КАК Документ,
               |	втПоступление.Ссылка.Проведен КАК Проведен,
               |	ПРЕДСТАВЛЕНИЕ(втПоступление.Ссылка) КАК ПредставлениеДокумента,
               |	DR_СобытияНакладнаяВходящая.ИдентификаторЦепочки КАК ИдентификаторЦепочки
               |ПОМЕСТИТЬ втДанныеИсточник
               |ИЗ
               |	втПоступление КАК втПоступление
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_СобытияНакладнаяВходящая
               |		ПО втПоступление.Ссылка = DR_СобытияНакладнаяВходящая.Документ
               |			И (DR_СобытияНакладнаяВходящая.ВидДокумента = ""Накладная_Входящая"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК СобытияRECADVИсходящий
               |		ПО (DR_СобытияНакладнаяВходящая.ИдентификаторЦепочки = СобытияRECADVИсходящий.ИдентификаторЦепочки)
               |			И (СобытияRECADVИсходящий.ВидДокумента = ""RECADV_Исходящий"")
               |ГДЕ
               |	СобытияRECADVИсходящий.ИдентификаторЦепочки ЕСТЬ NULL
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ ПЕРВЫЕ 5
               |	втДанныеИсточник.Документ КАК Документ,
               |	""RECADV_Исходящий"" КАК ВидДокумента,
               |	"""" КАК СтатусОбработкиДокумента
               |ИЗ
               |	втДанныеИсточник КАК втДанныеИсточник
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_ЦепочкиДокументов КАК DR_ЦепочкиДокументов
               |		ПО втДанныеИсточник.ИдентификаторЦепочки = DR_ЦепочкиДокументов.ИдентификаторЦепочки
               |
               |УПОРЯДОЧИТЬ ПО
               |	DR_ЦепочкиДокументов.ДатаЗаказа УБЫВ";
</value>
				<presentation>ТекстЗапроса</presentation>
				<id xsi:type="xs:decimal">0</id>
			</item>
		</Value>
	</row>
</ValueTree>