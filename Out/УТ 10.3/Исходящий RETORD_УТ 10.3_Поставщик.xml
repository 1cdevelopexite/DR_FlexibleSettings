<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ИмяКнопки</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Данные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Регламент</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Исходящий RETORD</Value>
		<Value xsi:type="xs:string">Исходящий RETORD</Value>
		<Value xsi:type="xs:string">ИсходящийRetord</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">#Область ШАПКА_Заполнение
               
Запрос = Новый Запрос;
Запрос.Текст ="ВЫБРАТЬ
              |	DR_Документ.Ссылка КАК Источник,
              |	DR_Документ.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
              |	DR_Документ.ИдентификаторДокумента КАК ИдентификаторДокумента,
              |	ПОДСТРОКА(DR_Документ.Комментарий, 1, 70) КАК Комментарий,
              |	DR_Документ.ВидДокумента КАК ВидДокумента
              |ПОМЕСТИТЬ втИсточник
              |ИЗ
              |	Документ.DR_Документ КАК DR_Документ
              |ГДЕ
              |	DR_Документ.Ссылка В(&amp;Документ)
              |	И DR_Документ.Статус = ""ГотовКОтправке""
              |	И НЕ DR_Документ.ПометкаУдаления
              |;
              |
              |////////////////////////////////////////////////////////////////////////////////
              |ВЫБРАТЬ
              |	втИсточник.Источник КАК Источник,
              |	втИсточник.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
              |	втИсточник.ИдентификаторДокумента КАК ИдентификаторДокумента,
              |	втИсточник.ВидДокумента КАК ВидДокумента,
              |	втИсточник.Комментарий КАК INFO,
              |	ВЫРАЗИТЬ(Валюта.Значение КАК Справочник.Валюты) КАК Валюта,
              |	ВЫРАЗИТЬ(NUMBER.Значение КАК СТРОКА(25)) КАК NUMBER,
              |	ВЫРАЗИТЬ(ДатаЭлДокумента.Значение КАК ДАТА) КАК ДатаЗаказа,
              |	ВЫРАЗИТЬ(CAMPAIGNNUMBER.Значение КАК СТРОКА(70)) КАК CAMPAIGNNUMBER,
              |	ВЫРАЗИТЬ(ДатаПоставки.Значение КАК ДАТА) КАК ДатаПоставки,
              |	ВЫРАЗИТЬ(SUPPLIER.Значение КАК СТРОКА(13)) КАК SUPPLIER,
              |	ВЫРАЗИТЬ(BUYER.Значение КАК СТРОКА(13)) КАК BUYER,
              |	ВЫРАЗИТЬ(DELIVERYPLACE.Значение КАК СТРОКА(13)) КАК DELIVERYPLACE,
              |	ВЫРАЗИТЬ(SUPPLIER.Значение КАК СТРОКА(13)) КАК SENDER,
              |	ВЫРАЗИТЬ(BUYER.Значение КАК СТРОКА(13)) КАК RECIPIENT,
              |	ВЫРАЗИТЬ(Организация.Значение КАК Справочник.Организации) КАК Организация,
              |	POSITION.ХранилищеЗначения КАК POSITION,
              |	""220"" КАК DOCUMENTNAME,
              |	ВЫРАЗИТЬ("""" КАК СТРОКА(10)) КАК DATE,
              |	ВЫРАЗИТЬ("""" КАК СТРОКА(10)) КАК DELIVERYDATE,
              |	ВЫРАЗИТЬ("""" КАК СТРОКА(3)) КАК CURRENCY,
              |	""O"" КАК DOCTYPE,
              |	""RETORD"" КАК ORDRTYPE,
              |	""ORDER"" КАК ТипДокумента,
              |	""Отправлен"" КАК Статус,
			  |	ВЫРАЗИТЬ("""" КАК СТРОКА(20)) КАК EDIINTERCHANGEID,
			  |	ВЫРАЗИТЬ("""" КАК СТРОКА(300)) КАК EDIMESSAGE,
			  |	ВЫРАЗИТЬ("""" КАК СТРОКА(300)) КАК ФайлИмя,
              |	ВЫРАЗИТЬ("""" КАК СТРОКА(300)) КАК Идентификатор                                          
              |ИЗ
              |	втИсточник КАК втИсточник
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК Валюта
              |		ПО втИсточник.Источник = Валюта.Ссылка
              |			И (Валюта.Реквизит = ""Валюта"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК NUMBER
              |		ПО втИсточник.Источник = NUMBER.Ссылка
              |			И (NUMBER.Реквизит = ""NUMBER"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК ДатаЭлДокумента
              |		ПО втИсточник.Источник = ДатаЭлДокумента.Ссылка
              |			И (ДатаЭлДокумента.Реквизит = ""ДатаЭлектронногоДокумента"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК CAMPAIGNNUMBER
              |		ПО втИсточник.Источник = CAMPAIGNNUMBER.Ссылка
              |			И (CAMPAIGNNUMBER.Реквизит = ""CAMPAIGNNUMBER"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК ДатаПоставки
              |		ПО втИсточник.Источник = ДатаПоставки.Ссылка
              |			И (ДатаПоставки.Реквизит = ""ДатаПоставки"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК SUPPLIER
              |		ПО втИсточник.Источник = SUPPLIER.Ссылка
              |			И (SUPPLIER.Реквизит = ""SUPPLIER"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК BUYER
              |		ПО втИсточник.Источник = BUYER.Ссылка
              |			И (BUYER.Реквизит = ""BUYER"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК DELIVERYPLACE
              |		ПО втИсточник.Источник = DELIVERYPLACE.Ссылка
              |			И (DELIVERYPLACE.Реквизит = ""DELIVERYPLACE"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК Организация
              |		ПО втИсточник.Источник = Организация.Ссылка
              |			И (Организация.Реквизит = ""Организация"")
              |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.DR_Документ.ДополнительныеРеквизиты КАК POSITION
              |		ПО втИсточник.Источник = POSITION.Ссылка
              |			И (POSITION.Реквизит = ""POSITION"")";

Запрос.УстановитьПараметр("Документ", Источник);

РезультатЗапроса = Запрос.Выполнить(); 
Результат = РезультатЗапроса.Выгрузить();

EDIINTERCHANGEID = 0;

КвалификаторСтроки = Новый КвалификаторыСтроки(250,ДопустимаяДлина.Переменная);

МассивТипов = Новый Массив;
МассивТипов.Добавить(Тип("Число"));
МассивТипов.Добавить(Тип("Строка"));

ТабличнаяЧастьRETORD = Новый ТаблицаЗначений;
ТабличнаяЧастьRETORD.Колонки.Добавить("Источник"				, Новый ОписаниеТипов("ДокументСсылка.DR_Документ"));
ТабличнаяЧастьRETORD.Колонки.Добавить("ORDERUNIT"				, Новый ОписаниеТипов("Строка"		, КвалификаторСтроки));

ТабличнаяЧастьRETORD.Колонки.Добавить("POSITIONNUMBER"			, Новый ОписаниеТипов(МассивТипов	, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("ORDEREDQUANTITY"			, Новый ОписаниеТипов(МассивТипов	, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("ORDERPRICE"				, Новый ОписаниеТипов(МассивТипов	, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("PRICEWITHVAT"			, Новый ОписаниеТипов(МассивТипов	, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("VAT"						, Новый ОписаниеТипов("Строка"		, КвалификаторСтроки));

ТабличнаяЧастьRETORD.Колонки.Добавить("PRODUCT"					, Новый ОписаниеТипов("Строка"		, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("PRODUCTIDBUYER"			, Новый ОписаниеТипов("Строка"		, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("PRODUCTIDSUPPLIER"		, Новый ОписаниеТипов("Строка"		, КвалификаторСтроки));
ТабличнаяЧастьRETORD.Колонки.Добавить("DESCRIPTION"				, Новый ОписаниеТипов("Строка"		, КвалификаторСтроки));

Для Каждого Строка Из Результат Цикл
    
    POSITION = Строка.POSITION.Получить();
	
	Для Каждого ТекСтрока Из POSITION Цикл
		
		НоваяСтрока = ТабличнаяЧастьRETORD.Добавить();
		
		ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекСтрока); 
				
		НоваяСтрока.Источник  		= Строка.Источник;
		НоваяСтрока.POSITIONNUMBER  = XMLСтрока(ТекСтрока.POSITIONNUMBER);		
		НоваяСтрока.ORDEREDQUANTITY = XMLСтрока(ТекСтрока.ORDEREDQUANTITY);
		НоваяСтрока.ORDERPRICE 		= XMLСтрока(ТекСтрока.ORDERPRICE);
		НоваяСтрока.PRICEWITHVAT 	= XMLСтрока(ТекСтрока.PRICEWITHVAT);
		НоваяСтрока.VAT 			= ?(ТекСтрока.VAT = "0", "без НДС", ТекСтрока.VAT);
		
		Если ТипЗнч(ТекСтрока.ЕдиницаИзмерения) = Тип("СправочникСсылка.ЕдиницыИзмерения") Тогда
			ЕдИзмКод = СокрЛП(ТекСтрока.ЕдиницаИзмерения.ЕдиницаПоКлассификатору.Код);		
		Иначе
			ЕдИзмКод = СокрЛП(ТекСтрока.ЕдиницаИзмерения.Код);	
		КонецЕсли;
		
		Если ЕдИзмКод = "796" Тогда
			НоваяСтрока.ORDERUNIT = "PCE";
		ИначеЕсли ЕдИзмКод = "166" Тогда
		    НоваяСтрока.ORDERUNIT = "KGM";
		ИначеЕсли ЕдИзмКод = "112" Тогда
		    НоваяСтрока.ORDERUNIT = "LTR";
		ИначеЕсли ЕдИзмКод = "778" Тогда
		    НоваяСтрока.ORDERUNIT = "NMP";
		КонецЕсли;
		
		НоваяСтрока.DESCRIPTION		= Строка(ТекСтрока.Номенклатура);		
				
	КонецЦикла;
    
    EDIINTERCHANGEID = НовыйНомерТранзакции(EDIINTERCHANGEID);
       
    Строка.DATE                 = Формат(Строка.ДатаЗаказа, "ДФ=yyyy-MM-dd");    
    Строка.DELIVERYDATE         = Формат(Строка.ДатаПоставки, "ДФ=yyyy-MM-dd");
    
    Если ЗначениеЗаполнено(Строка.Валюта) Тогда
		
		Строка.CURRENCY = Строка(Строка.Валюта);
		
		ПрефиксВалюта  = Лев(ВРег(Строка.CURRENCY),3); 
	    
	    Если ПрефиксВалюта = ВРег("руб") ИЛИ ПрефиксВалюта = ВРег("Росс") ИЛИ ПрефиксВалюта = ВРег("Russ") Тогда
	    	Строка.CURRENCY = "RUB";   
	    КонецЕсли;
	
	КонецЕсли;
        
    Строка.EDIINTERCHANGEID     = Формат(EDIINTERCHANGEID, "ЧГ=0");
    Строка.EDIMESSAGE           = Формат(ТекущаяДата(), "ДФ=ггггММддЧЧммсс000") + "-OUT-" + Строка.EDIINTERCHANGEID;
    Строка.ФайлИмя              = Строка.ТипДокумента + "_" + Строка.EDIMESSAGE + ".xml";
    Строка.Идентификатор        = Строка.ТипДокумента + "_" + Строка.EDIMESSAGE;
    
КонецЦикла;

#КонецОбласти
 
#Область СОЗДАНИЕ_XML 
ОбязательныеКолонки = Новый СписокЗначений;

//ORDER
ОбязательныеКолонки.Добавить("DOCUMENTNAME"	, "DOCUMENTNAME"	, Истина);
ОбязательныеКолонки.Добавить("NUMBER"		, "NUMBER"			, Истина);
ОбязательныеКолонки.Добавить("DATE"			, "DATE" 			, Истина);
ОбязательныеКолонки.Добавить("DELIVERYDATE"	, "DELIVERYDATE" 	, Истина);

//HEAD
ОбязательныеКолонки.Добавить("SUPPLIER"			, "SUPPLIER"		, Истина);
ОбязательныеКолонки.Добавить("BUYER"			, "BUYER"			, Истина);
ОбязательныеКолонки.Добавить("RECIPIENT"		, "RECIPIENT"		, Истина);
ОбязательныеКолонки.Добавить("DELIVERYPLACE"	, "DELIVERYPLACE"	, Истина);
ОбязательныеКолонки.Добавить("SENDER"			, "SENDER"			, Истина);

//POSITION
ОбязательныеКолонки.Добавить("POSITIONNUMBER"	, "POSITIONNUMBER"		, Истина);
ОбязательныеКолонки.Добавить("PRODUCT"			, "PRODUCT"				, Истина);
ОбязательныеКолонки.Добавить("PRODUCTIDBUYER"	, "PRODUCTIDBUYER"		, Истина);
ОбязательныеКолонки.Добавить("DESCRIPTION"		, "DESCRIPTION"			, Истина);
ОбязательныеКолонки.Добавить("ORDEREDQUANTITY"	, "ORDEREDQUANTITY"		, Истина);
ОбязательныеКолонки.Добавить("ORDERPRICE"		, "ORDERPRICE"			, Истина);
ОбязательныеКолонки.Добавить("VAT"				, "VAT"					, Истина);

МассивСтруктурИсходящих = Новый Массив;

//Структура свойств шапки документа
СтруктураШапка = Новый Структура("DOCUMENTNAME, NUMBER, DATE, DELIVERYDATE, CAMPAIGNNUMBER, 
								| DOCTYPE, ORDRTYPE, CURRENCY, INFO, HEAD");
									
//Структура свойств элемента HEAD
СтруктураHEAD = Новый Структура("SUPPLIER, BUYER, DELIVERYPLACE, SENDER, RECIPIENT, EDIINTERCHANGEID, EDIMESSAGE, POSITION");	

//Имена свойств элемента POSITION
СвойстваPOSITION = "POSITIONNUMBER, PRODUCT, PRODUCTIDBUYER, PRODUCTIDSUPPLIER, ORDEREDQUANTITY,
				   | ORDERUNIT, ORDERPRICE, PRICEWITHVAT, VAT, DESCRIPTION, QUANTITYOFCUINTU"; 

//Основной цикл
Для каждого СтрокаШапкиДокумента из Результат Цикл

  	ТекстСообщенияПроверкиЗаполненияОбязательныхПолей = "";  
	
	//Заполнение структуры документа
	СтруктураДок = Новый Структура("ORDER");
	    
	СтруктураДок.ORDER = СтруктураШапка;
	СтруктураШапка.HEAD = СтруктураHEAD;
	
	//Заполнение значений свойств шапки документа
	ЗаполнитьЗначенияСвойств(СтруктураШапка, СтрокаШапкиДокумента);
	
	//Заполнение значений свойств элемента HEAD
	ЗаполнитьЗначенияСвойств(СтруктураHEAD, СтрокаШапкиДокумента);
	
	МассивPOSITION = Новый Массив;
	    
	ОтборСтрокНоменклатур = Новый Структура;
	ОтборСтрокНоменклатур.Вставить("Источник", СтрокаШапкиДокумента.Источник);
	
	СтрокиНоменклатурДокумента = ТабличнаяЧастьRETORD.НайтиСтроки(ОтборСтрокНоменклатур);
	
	Для Каждого СтрокаНоменклатурыДокумента Из СтрокиНоменклатурДокумента Цикл
		
		//Создание структуры POSITION
		Структура = Новый Структура(СвойстваPOSITION);
		
		//Заполнение значений свойств элемента POSITION
		ЗаполнитьЗначенияСвойств(Структура, СтрокаНоменклатурыДокумента);
		
		МассивPOSITION.Добавить(Структура);
	КонецЦикла;
		
	СтруктураHEAD.POSITION = МассивPOSITION;
	
	
	//Создание XML строки
	XMLДокумент        	= Новый ЗаписьXML;		
	ПараметрыЗаписиXML 	= Новый ПараметрыЗаписиXML("UTF-8", "1.0", Истина, Ложь, Символы.Таб); 
	XMLДокумент.УстановитьСтроку("UTF-8");
	XMLДокумент.ЗаписатьОбъявлениеXML();
	
	Для каждого СтрокаЭлемента Из СтруктураДок Цикл
		ЗаписатьБлоки(XMLДокумент, СтрокаЭлемента, ОбязательныеКолонки, ТекстСообщенияПроверкиЗаполненияОбязательныхПолей);
	КонецЦикла;	
	
	СтрокаXML = XMLДокумент.Закрыть(); 
	
	Если ЗначениеЗаполнено(ТекстСообщенияПроверкиЗаполненияОбязательныхПолей) Тогда
		
		ТекстЛогаСобытий = ТекстСообщенияПроверкиЗаполненияОбязательныхПолей + Символы.ПС + "Документ был пропущен.";
		
		ДобавитьЗаписьВМассивЛога(МассивЛогаСобытий, ТекстЛогаСобытий, "Предупреждение", ИмяСобытия);
		
		Продолжить;	
	Иначе	
		
		СтруктураФайлаДанных = Новый Структура;
		СтруктураФайлаДанных.Вставить("ВидДокумента"			, СтрокаШапкиДокумента.ВидДокумента);
		СтруктураФайлаДанных.Вставить("Документ"				, СтрокаШапкиДокумента.Источник);
		СтруктураФайлаДанных.Вставить("ИдентификаторЦепочки"	, СтрокаШапкиДокумента.ИдентификаторЦепочки);
		СтруктураФайлаДанных.Вставить("ИмяФайлаXML"				, СтрокаШапкиДокумента.ФайлИмя);
		СтруктураФайлаДанных.Вставить("КодировкаФайла"			, "UTF-8");
		СтруктураФайлаДанных.Вставить("Организация"				, СтрокаШапкиДокумента.Организация);
		СтруктураФайлаДанных.Вставить("Отправлен"				, НЕОПРЕДЕЛЕНО);
		СтруктураФайлаДанных.Вставить("Сообщение"				, "");
		СтруктураФайлаДанных.Вставить("Статус"					, СтрокаШапкиДокумента.Статус);
		СтруктураФайлаДанных.Вставить("СтрокаXML"				, СтрокаXML);
		СтруктураФайлаДанных.Вставить("ТипФайла"				, СтрокаШапкиДокумента.ВидДокумента);
		СтруктураФайлаДанных.Вставить("Идентификатор"			, СтрокаШапкиДокумента.ИдентификаторДокумента);
		СтруктураФайлаДанных.Вставить("ОбновитьСтатусДокумента"	, Истина);
		
		МассивСтруктурИсходящих.Добавить(СтруктураФайлаДанных);
		
	КонецЕсли;
	
КонецЦикла;

#КонецОбласти

//Возврат Результат;				//раскомментировать для отображения значений таблицы "Результат" на вкладке "Тестирование"  
//Возврат ТабличнаяЧастьRETORD;		//раскомментировать для отображения значений таблицы "РезультатНоменклатур" на вкладке "Тестирование"

Возврат МассивСтруктурИсходящих;</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">8</lastId>
			<item>
				<value xsi:type="xs:string">Прайс-лист</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Поставщик</value>
				<presentation>СписокRetordИсходящиеПоставщик</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Покупатель</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Синоним</value>
				<presentation>Исходящий RETORD</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>ИсходящийRetord</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ПередаватьТекстПричины</value>
				<id xsi:type="xs:decimal">5</id>
			</item>
			<item>
				<value xsi:type="xs:string">ПриемникВидДокумента</value>
				<presentation>ORDER_Исходящий</presentation>
				<id xsi:type="xs:decimal">6</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИсточникВидДокумента</value>
				<presentation>RETORD_Исходящий</presentation>
				<id xsi:type="xs:decimal">7</id>
			</item>
			<item>
				<value xsi:type="xs:string">НужнаПодпись</value>
				<presentation>Нет</presentation>
				<id xsi:type="xs:decimal">8</id>
			</item>
		</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">1</lastId>
			<item>
				<value xsi:type="xs:string">ТекстЗапроса =  "ВЫБРАТЬ
                |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
                |	DR_События.Документ КАК Документ,
                |	DR_События.Идентификатор КАК Идентификатор
                |ПОМЕСТИТЬ ВТ_ЗАКАЗЫ
                |ИЗ
                |	РегистрСведений.DR_События КАК DR_События
                |ГДЕ
                |	DR_События.ВидДокумента = ""ORDER_Обратный_Исходящий""
                |	И ВЫРАЗИТЬ(DR_События.Документ КАК Документ.DR_Документ).Статус = ""ГотовКОтправке""
                |	И DR_События.Статус &lt;&gt; ""Архивный""
                |;
                |
                |////////////////////////////////////////////////////////////////////////////////
                |ВЫБРАТЬ
                |	DR_События.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
                |	DR_События.ИдентификаторОснования КАК ИдентификаторОснования,
                |	DR_События.Документ КАК Документ,
                |	МАКСИМУМ(DR_События.ДатаЗаписи) КАК ДатаЗаписи
                |ПОМЕСТИТЬ ВТ_RETORD
                |ИЗ
                |	РегистрСведений.DR_События КАК DR_События
                |ГДЕ
                |	DR_События.ВидДокумента = ""ORDER_Обратный_Исходящий""
                |	И DR_События.Документ.Статус = ""Отправлен""
                |
                |СГРУППИРОВАТЬ ПО
                |	DR_События.ИдентификаторЦепочки,
                |	DR_События.ИдентификаторОснования,
                |	DR_События.Документ
                |;
                |
                |////////////////////////////////////////////////////////////////////////////////
                |ВЫБРАТЬ ПЕРВЫЕ 2
                |	ВТ_ЗАКАЗЫ.Документ КАК Документ,
                |	""ORDRSP_Исходящий"" КАК ВидДокумента,
                |	"""" КАК СтатусОбработкиДокумента
                |ИЗ
                |	ВТ_ЗАКАЗЫ КАК ВТ_ЗАКАЗЫ
                |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_RETORD КАК ВТ_RETORD
                |		ПО ВТ_ЗАКАЗЫ.ИдентификаторЦепочки = ВТ_RETORD.ИдентификаторЦепочки
                |			И ВТ_ЗАКАЗЫ.Идентификатор = ВТ_RETORD.ИдентификаторОснования
                |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_ЦепочкиДокументов КАК DR_ЦепочкиДокументов
                |		ПО ВТ_ЗАКАЗЫ.ИдентификаторЦепочки = DR_ЦепочкиДокументов.ИдентификаторЦепочки
                |ГДЕ
                |	ВТ_ЗАКАЗЫ.Документ.Проведен
                |	И ВТ_RETORD.ИдентификаторЦепочки ЕСТЬ NULL
                |
                |УПОРЯДОЧИТЬ ПО
                |	DR_ЦепочкиДокументов.ДатаЗаказа УБЫВ";</value>
				<presentation>ТекстЗапроса</presentation>
				<id xsi:type="xs:decimal">0</id>
			</item>
		</Value>
	</row>
</ValueTree>