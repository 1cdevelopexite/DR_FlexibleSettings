ТекстЗапроса = "ВЫБРАТЬ
               |	DR_НастройкиДополнительныеРеквизиты.Реквизит КАК Реквизит,
               |	ВЫРАЗИТЬ(DR_НастройкиДополнительныеРеквизиты.Значение КАК СТРОКА(250)) КАК ВидДокумента
               |ПОМЕСТИТЬ ВтВидыДокументов
               |ИЗ
               |	Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_НастройкиДополнительныеРеквизиты
               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки КАК DR_Настройки
               |		ПО DR_НастройкиДополнительныеРеквизиты.Ссылка = DR_Настройки.Ссылка
               |ГДЕ
               |	DR_Настройки.Наименование = ""ВидыДокументов""
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	СчетФактураВыданный.Номер КАК Номер,
               |	СчетФактураВыданный.Дата КАК Дата,
               |	DR_ЦепочкиДокументов.НомерЗаказа КАК НомерЗаказа,
               |	DR_ЦепочкиДокументов.ДатаЗаказа КАК ДатаЗаказа,
               |	DR_ЦепочкиДокументов.ДатаПоставки КАК ДатаПоставки,
               |	СУММА(РеализацияТоваровУслугТовары.Сумма) КАК СуммаДокумента,
               |	СУММА(РеализацияТоваровУслугТовары.Количество) КАК Количество,
               |	DR_События_СЧФ.Сообщение КАК Сообщение,
               |	МАКСИМУМ(DR_События_СЧФ.ДатаЗаписи) КАК ДатаЗаписи,
               |	СчетФактураВыданный.Ссылка КАК Документ,
               |	ВЫБОР
               |		КОГДА СчетФактураВыданный.ПометкаУдаления
               |			ТОГДА 2
               |		КОГДА СчетФактураВыданный.Проведен
               |			ТОГДА 1
               |		ИНАЧЕ 0
               |	КОНЕЦ КАК Документ__КартинкаСтатус,
               |	ЕСТЬNULL(DR_События_Заказ.Документ, ЗНАЧЕНИЕ(Документ.СчетНаОплатуПокупателю.ПустаяСсылка)) КАК ДокументЗаказ,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(DR_События_Заказ.Документ КАК Документ.СчетНаОплатуПокупателю).ПометкаУдаления
               |			ТОГДА 2
               |		КОГДА ВЫРАЗИТЬ(DR_События_Заказ.Документ КАК Документ.СчетНаОплатуПокупателю).Проведен
               |			ТОГДА 1
               |		ИНАЧЕ 0
               |	КОНЕЦ КАК ДокументЗаказ__КартинкаСтатус,
               |	DR_События_СЧФ.ВидДокумента КАК ВидДокумента,
               |	DR_События_СЧФ.ДатаСообщения КАК ДатаСообщения,
               |	DR_События_СЧФ.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	DR_События_СЧФ.Идентификатор КАК Идентификатор,
               |	DR_События_СЧФ.ИдентификаторОснования КАК ИдентификаторОснования
               |ПОМЕСТИТЬ ВтОсновная
               |ИЗ
               |	РегистрСведений.DR_События КАК DR_События_СЧФ
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_ЦепочкиДокументов КАК DR_ЦепочкиДокументов
               |		ПО DR_События_СЧФ.ИдентификаторЦепочки = DR_ЦепочкиДокументов.ИдентификаторЦепочки
               |			И РАЗНОСТЬДАТ(DR_ЦепочкиДокументов.ДатаЗаказа, DR_События_СЧФ.ДатаЗаписи, ДЕНЬ) МЕЖДУ 0 И &ПериодСвязиДокументов								  
               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный КАК СчетФактураВыданный
               |		ПО DR_События_СЧФ.Документ = СчетФактураВыданный.Ссылка
               |			И (DR_События_СЧФ.ВидДокумента = ""СчетФактура_Исходящий"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_События_РТУ
               |		ПО DR_События_СЧФ.ИдентификаторЦепочки = DR_События_РТУ.ИдентификаторЦепочки
               |			И (DR_События_РТУ.ВидДокумента = ""Накладная_Исходящая"")
               |			И (DR_События_СЧФ.ИдентификаторОснования = DR_События_РТУ.Идентификатор)
               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
               |		ПО (DR_События_РТУ.Документ = РеализацияТоваровУслугТовары.Ссылка)
               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.DR_События КАК DR_События_Заказ
               |		ПО DR_События_СЧФ.ИдентификаторЦепочки = DR_События_Заказ.ИдентификаторЦепочки
               |			И (DR_События_Заказ.ВидДокумента = ""Заказ_Входящий"")
               |			И (DR_События_РТУ.ИдентификаторОснования = DR_События_Заказ.Идентификатор)
               |ГДЕ
               |	НЕ СчетФактураВыданный.Исправление
               |	И СчетФактураВыданный.ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
               |    И DR_События_СЧФ.Статус <> ""Архивный""
               |
               |СГРУППИРОВАТЬ ПО
               |	СчетФактураВыданный.Номер,
               |	СчетФактураВыданный.Дата,
               |	DR_ЦепочкиДокументов.НомерЗаказа,
               |	DR_ЦепочкиДокументов.ДатаЗаказа,
               |	DR_ЦепочкиДокументов.ДатаПоставки,
               |	DR_События_СЧФ.Сообщение,
               |	СчетФактураВыданный.Ссылка,
               |	DR_События_СЧФ.ВидДокумента,
               |	DR_События_СЧФ.ДатаСообщения,
               |	DR_События_СЧФ.ИдентификаторЦепочки,
               |	DR_События_СЧФ.Идентификатор,
               |	DR_События_СЧФ.ИдентификаторОснования,
               |	ВЫБОР
               |		КОГДА СчетФактураВыданный.ПометкаУдаления
               |			ТОГДА 2
               |		КОГДА СчетФактураВыданный.Проведен
               |			ТОГДА 1
               |		ИНАЧЕ 0
               |	КОНЕЦ,
               |	ВЫБОР
               |		КОГДА ВЫРАЗИТЬ(DR_События_Заказ.Документ КАК Документ.СчетНаОплатуПокупателю).ПометкаУдаления
               |			ТОГДА 2
               |		КОГДА ВЫРАЗИТЬ(DR_События_Заказ.Документ КАК Документ.СчетНаОплатуПокупателю).Проведен
               |			ТОГДА 1
               |		ИНАЧЕ 0
               |	КОНЕЦ,
               |	ЕСТЬNULL(DR_События_Заказ.Документ, ЗНАЧЕНИЕ(Документ.СчетНаОплатуПокупателю.ПустаяСсылка))
               |
               |ИНДЕКСИРОВАТЬ ПО
               |	ИдентификаторЦепочки,
               |	Идентификатор
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВтОсновная.Номер КАК Номер,
               |	ВтОсновная.Дата КАК Дата,
               |	ВтОсновная.НомерЗаказа КАК НомерЗаказа,
               |	ВтОсновная.ДатаЗаказа КАК ДатаЗаказа,
               |	ВтОсновная.ДатаПоставки КАК ДатаПоставки,
               |	ВтОсновная.СуммаДокумента КАК СуммаДокумента,
               |	ВтОсновная.Количество КАК Количество,
               |	ВтОсновная.Сообщение КАК Сообщение,
               |	ВтОсновная.ДатаЗаписи КАК ДатаЗаписи,
               |	ВтОсновная.Документ КАК Документ,
               |	ВтОсновная.Документ__КартинкаСтатус КАК Документ__КартинкаСтатус,
               |	ВтОсновная.ДокументЗаказ КАК ДокументЗаказ,
               |	ВтОсновная.ДокументЗаказ__КартинкаСтатус КАК ДокументЗаказ__КартинкаСтатус,
               |	ВидыДокументов.ВидДокумента КАК ВидДокумента,
               |	ВтОсновная.ДатаСообщения КАК ДатаСообщения,
               |	ВтОсновная.ИдентификаторЦепочки КАК ИдентификаторЦепочки,
               |	ВтОсновная.Идентификатор КАК Идентификатор,
               |	ВтОсновная.ИдентификаторОснования КАК ИдентификаторОснования
               |ИЗ
               |	ВтОсновная КАК ВтОсновная
               |		ЛЕВОЕ СОЕДИНЕНИЕ ВтВидыДокументов КАК ВидыДокументов
               |		ПО ВтОсновная.ВидДокумента = ВидыДокументов.Реквизит";
			   
ЗаголовкиПоУмолчанию = Новый Структура;
ЗаголовкиПоУмолчанию.Вставить("Номер"						, "Номер");
ЗаголовкиПоУмолчанию.Вставить("Дата"						, "Дата");
ЗаголовкиПоУмолчанию.Вставить("ДатаЗаказа"					, "Дата заказа");
ЗаголовкиПоУмолчанию.Вставить("НомерЗаказа"					, "Номер заказа");
ЗаголовкиПоУмолчанию.Вставить("ДатаПоставки"				, "Дата поставки");
ЗаголовкиПоУмолчанию.Вставить("СуммаДокумента"				, "Сумма документа");
ЗаголовкиПоУмолчанию.Вставить("Количество"					, "Количество");
ЗаголовкиПоУмолчанию.Вставить("Сообщение"					, "Сообщение");
ЗаголовкиПоУмолчанию.Вставить("ДатаЗаписи"					, "Дата записи");
ЗаголовкиПоУмолчанию.Вставить("Документ"					, "Документ");
ЗаголовкиПоУмолчанию.Вставить("Документ__КартинкаСтатус" 	, "Документ__КартинкаСтатус");
ЗаголовкиПоУмолчанию.Вставить("ДокументЗаказ"				, "Документ заказ");
ЗаголовкиПоУмолчанию.Вставить("ДокументЗаказ__КартинкаСтатус" 	, "ДокументЗаказ__КартинкаСтатус");
ЗаголовкиПоУмолчанию.Вставить("ВидДокумента"				, "Вид документа");
ЗаголовкиПоУмолчанию.Вставить("ДатаСообщения"				, "Дата сообщения");
ЗаголовкиПоУмолчанию.Вставить("Идентификатор"				, "Идентификатор");
ЗаголовкиПоУмолчанию.Вставить("ИдентификаторОснования"		, "Идентификатор основания");
ЗаголовкиПоУмолчанию.Вставить("ИдентификаторЦепочки"		, "Идентификатор цепочки");
